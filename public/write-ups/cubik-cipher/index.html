<!DOCTYPE html>
<html><head>
  <meta charset="utf-8" />
  <title>
    
      Blog de TaylorDeDordogne
      | Cubik&#39; Cipher
    
  </title>
  <meta name="author" content="map[email:taylordedordogne@gmail.com name:TaylorDeDordogne]" />
  <meta name="description" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <link
    rel="icon"
    href="/favicon_io/favicon.ico"
    type="image/x-icon"
  />
  <link
    rel="icon"
    href="/favicon_io/favicon-16x16.png"
    size="16x16"
    type="image/png"
  />
  <link
    rel="icon"
    href="/favicon_io/favicon-32x32.png"
    size="32x32"
    type="image/png"
  />

  
  <link
    rel="alternate"
    type="application/rss+xml"
    href="/index.xml"
    title="Blog de TaylorDeDordogne"
  />

  <link
    rel="preload"
    type="text/css"
    href="/css/rose-pine.min.css"
    integrity=""
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  />
  <noscript>
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/rose-pine.min.css"
      integrity=""
    />
  </noscript><link rel="preconnect" href="https://fonts.googleapis.com" /><link
  rel="preconnect"
  href="https://fonts.gstatic.com"
  crossorigin
/><link
  href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;700&family=Roboto+Mono:wght@400;500;700&display=swap"
  rel="stylesheet"
/>
<link
    rel="preload"
    type="text/css"
    href="/css/toigian.min.b61aac0326c36b3a3319124f1f4ab30c8ce54f66f3ead7636cf33d56e7d0c6fa.css"
    integrity="sha256-thqsAybDazozGRJPH0qzDIzlT2bz6tdjbPM9VufQxvo="
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  />
  <noscript>
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/toigian.min.b61aac0326c36b3a3319124f1f4ab30c8ce54f66f3ead7636cf33d56e7d0c6fa.css"
      integrity="sha256-thqsAybDazozGRJPH0qzDIzlT2bz6tdjbPM9VufQxvo="
    />
  </noscript>

  
  <link
    rel="stylesheet"
    type="text/css"
    href="/css/light.min.29febe5c26ca625f7e2913e2509889a65637f415171eb003603102dea7cc42e0.css"
    integrity="sha256-Kf6+XCbKYl9+KRPiUJiJplY39BUXHrADYDEC3qfMQuA="
  />
  <link
    rel="stylesheet"
    type="text/css"
    href="/css/dark.min.47fea451289f4f246c4875ba0aa5f6376183f220c766f5e90d15d6e48cb7b937.css"
    integrity="sha256-R/6kUSifTyRsSHW6CqX2N2GD8iDHZvXpDRXW5Iy3uTc="
  />

  <script>
    
    if (
      localStorage.theme === "dark" ||
      (!("theme" in localStorage) &&
        window.matchMedia("(prefers-color-scheme: dark)").matches)
    ) {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }
  </script>

  
  
  <script
    defer
    src="/js/main.dfa968b06ebe7fb755eb156f7296445f20bd5ca0c82aa2eb755b1bfac4e2f294676471cf7670590073c364901a0dd5dc4b4c7b83f7a4a3c3b081f085c78fa1de.js"
    integrity="sha512-36losG6&#43;f7dV6xVvcpZEXyC9XKDIKqLrdVsb&#43;sTi8pRnZHHPdnBZAHPDZJAaDdXcS0x7g/eko8OwgfCFx4&#43;h3g=="
  ></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ startOnLoad: true, securityLevel: "loose" });
  </script>
  
  
</head>
<body><header style="--layer: 10">
  <div
    aria-hidden="true"
    class="absolute top-[-1000px] left-0 z-[calc(var(--layer)+1)] h-[calc(1000px+var(--page-top))] w-full bg-base"
  ></div>

  <div
    class="fixed top-0 left-0 z-[var(--layer)] flex h-header-height w-full items-center border-b px-page-gutter before:absolute before:inset-0 before:z-[-1] before:bg-base [@supports(backdrop-filter:blur(0))]:before:bg-base [@supports(backdrop-filter:blur(0))]:before:backdrop-blur-md"
  ><div
  class="lowercase italic mx-auto flex w-full max-w-content items-center justify-between"
>
  <nav>
    <ol class="flex text-md items-center">
      
  
    
  
    
  
  
  
  <li>
    
    
    <a href="/" class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Blog de TaylorDeDordogne</a>
  </li>
  
    <li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li>
  

  
  
  
  <li>
    
    
    <a href="/write-ups/" class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Write ups</a>
  </li>
  
    <li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li>
  

  
  
  
    
  
  <li>
    
    
    <a href="/write-ups/cubik-cipher/" class="focus:underline focus:outline-none font-bold after:md:mx-2 after:mx-0.5">Cubik&#39; Cipher</a>
  </li>
  

    </ol>
  </nav>
  <nav>
    <a href="/index.xml"
      ><svg
        width="18px"
        height="18px"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"
        />
      </svg>
    </a>
  </nav>
</div>


</div>
</header>
<main class="flex justify-center px-page-gutter py-page-top">
      <div class="min-h-content w-full max-w-content space-y-10 sm:space-y-20"><div
  class="lowercase italic mx-auto flex w-full max-w-content items-center justify-between"
>
  <nav>
    <ol class="flex text-md items-center">
      
  
    
  
    
  
  
  
  <li>
    
    
    <a href="/" class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Blog de TaylorDeDordogne</a>
  </li>
  
    <li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li>
  

  
  
  
  <li>
    
    
    <a href="/write-ups/" class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Write ups</a>
  </li>
  
    <li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li>
  

  
  
  
    
  
  <li>
    
    
    <a href="/write-ups/cubik-cipher/" class="focus:underline focus:outline-none font-bold after:md:mx-2 after:mx-0.5">Cubik&#39; Cipher</a>
  </li>
  

    </ol>
  </nav>
  <nav>
    <a href="/index.xml"
      ><svg
        width="18px"
        height="18px"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"
        />
      </svg>
    </a>
  </nav>
</div>


<article>
  <h1>Cubik' Cipher</h1>
  <time class="text-sm italic tabular-nums text-muted"
  >2022/06/12&nbsp;</time
>

  

  
    <div class="section">
      
        
        <a href="/tags/hardware/" id="tag">Hardware</a>
      
        
        <a href="/tags/hackday-2022/" id="tag">HackDay 2022</a>
      
    </div>
  


  
    
      <details>
        <summary>Table of contents</summary>
        <div id="toc-list"><nav id="TableOfContents">
  <ol>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#analyse-du-programme-et-réimplémentation-en-python">Analyse du programme et réimplémentation en Python</a>
      <ol>
        <li><a href="#analyse-du-code-principal">Analyse du code principal</a></li>
        <li><a href="#analyse-de-la-fonction-key_randomize">Analyse de la fonction key_randomize</a></li>
        <li><a href="#analyse-de-la-fonction-de-chiffrement">Analyse de la fonction de chiffrement</a>
          <ol>
            <li><a href="#la-fonction-shiftmt">La fonction shiftmt:</a></li>
            <li><a href="#les-matrices-utilisées">Les matrices utilisées:</a></li>
            <li><a href="#la-fonction-mixrow-appellée-dans-la-fonction-mixmatrix">La fonction mixrow, appellée dans la fonction mixmatrix:</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#inversion-de-lalgorithme">Inversion de l&rsquo;algorithme</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ol>
</nav></div>
      </details>
    
  
  <div class="content"><h2 id="introduction">Introduction</h2>
<p>Cubik&rsquo;Cipher est un challenge de catégorie Hardware issu de l&rsquo;édition 2022 du HackDay, se présentant comme ceci:</p>
<blockquote>
<p>Il y&rsquo;a un mois, un espion a réussi à s&rsquo;infiltrer dans le repère secret d&rsquo;un ennemi!<br>
Celui ci était en train de développer son propre chiffreur de données!<br>
Depuis il semblerait que l&rsquo;ennemi l&rsquo;ait terminé, à nous de construire le déchiffreur grâce
auquel nous pourrons l&rsquo;espionner sans qu&rsquo;il s&rsquo;en rende compte!<br>
Le flag est de la forme HACKDAY{&hellip;}</p>
</blockquote>
<p>Étant joint avec l&rsquo;énoncé une archive contenant 5 fichiers:</p>
<blockquote>
<p>flag.txt<br>
test_vector.txt<br>
cubik_cipher - Copie.vhd<br>
cubik_pkg.vhd<br>
key_randomize.vhd</p>
</blockquote>
<p>Le fichier <code>flag.txt</code> contient une clé de 1024 bits et un flag chiffré de 576 bits. Le fichier <code>test_vector.txt</code> contient quant à lui un échantillon en clair du même format que le flag suivi de ce même échantillon chiffrée avec une autre clé.</p>
<p>On en déduit vite que le challenge est donc un mix Crypto/Hardware, implémentant un algorithme à inverser pour retrouver le flag en clair.<br>
<strong>L&rsquo;objectif sera donc de reprogrammer l&rsquo;algorithme en Python pour pouvoir ensuite l&rsquo;inverser.</strong></p>
<p>En jetant un oeil au trois fichier restant je découvre avec effroi qu&rsquo;il s&rsquo;agit de code VHDL, et me souvenant d&rsquo;un proverbe qu&rsquo;on m&rsquo;eut jadis donné : <em>&ldquo;VHDL, si vous ne connaissez pas, tant mieux pour vous&rdquo;</em> je pris peur mais décida nonobstant de me plonger dans le premier fichier: <code>cubik_cipher - Copie.vhd</code>.</p>
<h2 id="analyse-du-programme-et-réimplémentation-en-python">Analyse du programme et réimplémentation en Python</h2>
<h3 id="analyse-du-code-principal">Analyse du code principal</h3>
<hr>
<p>Armé de documentation, je découvre que ce code implémente une entité nommée <code>cubik_cipher</code> chargée de définir l&rsquo;engine de chiffrement et qui prendra en entrée deux bitvectors, un de taille <code>data_width</code> nommé <code>d_i</code> et un de taille 1024 nommé <code>key</code> correspondants respectivements au flag à chiffrer et à la clé de chiffrement.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vhdl" data-lang="vhdl"><span class="line"><span class="cl"><span class="k">entity</span> <span class="nc">cubik_cipher</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl">    <span class="k">generic</span> <span class="p">(</span><span class="n">round_div_2</span> <span class="o">:</span> <span class="kt">positive</span> <span class="o">:=</span> <span class="mi">8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">port</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">resetn</span> <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">clk</span>    <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- key</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span>    <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">1023</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- din</span>
</span></span><span class="line"><span class="cl">    <span class="n">d_v_i</span>  <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">d_i</span>    <span class="o">:</span> <span class="k">in</span>  <span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">data_width</span><span class="o">-</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- dout</span>
</span></span><span class="line"><span class="cl">    <span class="n">d_c</span>    <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">data_width</span><span class="o">-</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">d_v_c</span>  <span class="o">:</span> <span class="k">out</span>  <span class="kt">std_logic</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span> <span class="k">entity</span><span class="p">;</span>
</span></span></code></pre></div><p>On remarque par ailleurs que tout le système est soumis à une clock nommée <code>clk</code> ce qui est tout à fait normal étant donné que dans un code VHDL, tous les processus s&rsquo;exécutent en même temps et qu&rsquo;il est donc nécessaire de coordonner tout ca par une horloge.</p>
<p>En se penchant sur l&rsquo;architecture du modèle, on découvre les différents signaux utilisés par le modèle. Voici les principaux:</p>
<ul>
<li><code>key_w</code> : Une constante de valeur 576 qui servira à tronquer la clé <code>key</code> de 1024 bits.</li>
<li><code>ctr_round</code> : Un entier naturel compris entre 0 et 9, on suppose que le chiffrement fera 10 tours sur le flag.</li>
<li><code>reg_cipher</code> : Un bitvector de taille 576 qui contiendra les données à chiffrer durant les différents tours du chiffremenet.</li>
<li><code>rkey</code> : la troncature de <code>key</code> qui est passée en argument dans la fonction de chiffrement.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vhdl" data-lang="vhdl"><span class="line"><span class="cl"><span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">cubik_cipher</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl">    <span class="k">constant</span> <span class="n">key_w</span> <span class="o">:</span> <span class="kt">positive</span> <span class="o">:=</span> <span class="mi">576</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">type</span> <span class="n">state</span> <span class="k">is</span> <span class="p">(</span><span class="n">idle</span><span class="p">,</span> <span class="n">engine</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">signal</span> <span class="n">current_state</span><span class="p">,</span><span class="n">next_state</span>    <span class="o">:</span> <span class="n">state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">signal</span> <span class="n">ctr_round</span> <span class="o">:</span> <span class="kt">natural</span> <span class="k">range</span> <span class="mi">0</span> <span class="k">to</span> <span class="mi">9</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	 <span class="k">signal</span> <span class="n">load</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">signal</span> <span class="n">end_ctr</span><span class="p">,</span><span class="n">cmd_ctr</span> <span class="o">:</span> <span class="kt">std_logic</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">signal</span> <span class="n">rkey</span> <span class="o">:</span>  <span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">key_w</span><span class="o">-</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">signal</span> <span class="n">reg_cipher</span> <span class="o">:</span>  <span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">d_i</span><span class="na">&#39;range</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">begin</span>
</span></span></code></pre></div><p>Le reste des signaux faisants quant à eux, office de flags qui permettront au programme de modéliser l&rsquo;execution séquentille de l&rsquo;algorithme de chiffrement suivant:</p>
<ol>
<li>
<p>La clé <code>key</code> est passée dans la fonction <code>key_randomize</code> (définie dans le fichier <code>key_randomize.vhd</code>), la valeur de retour est stockée dans <code>rkey</code>.</p>
</li>
<li>
<p>Le programme charge <code>d_i</code> dans <code>reg_cipher</code></p>
</li>
<li>
<p>Le programme appelle 9 fois la fonction round avec <code>reg_cipher</code> et <code>rkey</code></p>
</li>
<li>
<p>A chaque tour, la fonction <code>key_randomize</code> est rappellée et sa valeur de retour est stockée dans <code>rkey</code>.</p>
</li>
</ol>
<h3 id="analyse-de-la-fonction-key_randomize">Analyse de la fonction key_randomize</h3>
<hr>
<p>La fonction <code>key_randomize</code> appellée à chaque tour se présente comme ceci:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vhdl" data-lang="vhdl"><span class="line"><span class="cl"><span class="k">entity</span> <span class="nc">key_randomize</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl">    <span class="k">generic</span> <span class="p">(</span><span class="n">key_w</span> <span class="o">:</span> <span class="kt">positive</span> <span class="o">:=</span> <span class="mi">32</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">port</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="n">resetn</span> <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">clk</span>    <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">load</span>   <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span>    <span class="o">:</span> <span class="k">in</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">1023</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">key_r</span>  <span class="o">:</span> <span class="k">out</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">key_w</span><span class="o">-</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span> <span class="k">entity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">architecture</span> <span class="nc">rtl</span> <span class="k">of</span> <span class="nc">key_randomize</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl"><span class="k">signal</span> <span class="n">reg</span> <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">key</span><span class="na">&#39;range</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">process</span> <span class="p">(</span><span class="n">clk</span><span class="p">,</span><span class="n">resetn</span><span class="p">)</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl">    <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">resetn</span> <span class="o">=</span> <span class="sc">&#39;0&#39;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">            <span class="n">reg</span>  <span class="o">&lt;=</span> <span class="p">(</span><span class="k">others</span> <span class="o">=&gt;</span> <span class="sc">&#39;1&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">elsif</span> <span class="n">rising_edge</span><span class="p">(</span><span class="n">clk</span><span class="p">)</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">load</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">                <span class="n">reg</span> <span class="o">&lt;=</span> <span class="n">key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="n">reg</span>      <span class="o">&lt;=</span> <span class="n">reg</span><span class="p">(</span><span class="n">reg</span><span class="na">&#39;length</span><span class="o">-</span><span class="mi">2</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">reg</span><span class="p">(</span><span class="n">reg</span><span class="na">&#39;high</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">reg</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>  <span class="o">&lt;=</span> <span class="n">reg</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span> <span class="k">xor</span> <span class="n">reg</span><span class="p">(</span><span class="n">reg</span><span class="na">&#39;high</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">reg</span><span class="p">(</span><span class="mi">421</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">reg</span><span class="p">(</span><span class="mi">420</span><span class="p">)</span> <span class="k">xor</span> <span class="n">reg</span><span class="p">(</span><span class="n">reg</span><span class="na">&#39;high</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">reg</span><span class="p">(</span><span class="mi">476</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">reg</span><span class="p">(</span><span class="mi">475</span><span class="p">)</span> <span class="k">xor</span> <span class="n">reg</span><span class="p">(</span><span class="n">reg</span><span class="na">&#39;high</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">reg</span><span class="p">(</span><span class="mi">545</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">reg</span><span class="p">(</span><span class="mi">544</span><span class="p">)</span> <span class="k">xor</span> <span class="n">reg</span><span class="p">(</span><span class="n">reg</span><span class="na">&#39;high</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">reg</span><span class="p">(</span><span class="mi">923</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">reg</span><span class="p">(</span><span class="mi">922</span><span class="p">)</span> <span class="k">xor</span> <span class="n">reg</span><span class="p">(</span><span class="n">reg</span><span class="na">&#39;high</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span> <span class="k">if</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span> <span class="k">process</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">key_r</span> <span class="o">&lt;=</span> <span class="n">reg</span><span class="p">(</span><span class="n">key_r</span><span class="na">&#39;range</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span> <span class="k">architecture</span><span class="p">;</span>
</span></span></code></pre></div><p>Le paramètre <code>load</code> indique si la fonction est appellée pour la première fois, si c&rsquo;est le cas, la fonction tronque juste la clé <code>key</code> pour garder seulement les 576 premiers bits et renvoie sa valeur dans <code>key_r</code>.</p>
<p>Si la fonction n&rsquo;est pas appellée pour la première fois, elle applique un Registre à décalage à rétroaction linéaire de Galois sur la clé puis renvoie la troncature dans <code>key_r</code>. Cet algorithme servant à générer des nombres pseudo-aléatoires se schématise comme ceci:</p>
<p><img src="assets/LFSR_Galois_8bits.png" alt="screenshot"></p>
<p>Le bit de poids fort est placé au début de la chaine et xor au passage des bits sélectionnés dans la chaine. En python on modélisera donc cette fonction par:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">galois_lfsr</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">high_bit</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">1023</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">23</span><span class="p">])</span> <span class="o">^</span> <span class="nb">int</span><span class="p">(</span><span class="n">high_bit</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span><span class="p">[</span><span class="mi">420</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">420</span><span class="p">])</span> <span class="o">^</span> <span class="nb">int</span><span class="p">(</span><span class="n">high_bit</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span><span class="p">[</span><span class="mi">475</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">475</span><span class="p">])</span> <span class="o">^</span> <span class="nb">int</span><span class="p">(</span><span class="n">high_bit</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span><span class="p">[</span><span class="mi">544</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">544</span><span class="p">])</span> <span class="o">^</span> <span class="nb">int</span><span class="p">(</span><span class="n">high_bit</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span><span class="p">[</span><span class="mi">922</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">922</span><span class="p">])</span> <span class="o">^</span> <span class="nb">int</span><span class="p">(</span><span class="n">high_bit</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">high_bit</span> <span class="o">+</span> <span class="n">key</span><span class="p">[:</span><span class="mi">1023</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">key</span>
</span></span></code></pre></div><h3 id="analyse-de-la-fonction-de-chiffrement">Analyse de la fonction de chiffrement</h3>
<hr>
<p>En inspectant le dernier fichier contenant la fonction de chiffrement <code>round</code>, on remarque que cette dernière est constituée de trois étapes qui exploiteront des types que le package a défini plus haut:</p>
<ul>
<li>Le <code>nonaire</code>, un bitvector de 9 bits.</li>
<li>La <code>row</code>, un tableau de 4 <code>nonaires</code>.</li>
<li>La <code>matrice</code>, un tableau de 4 <code>rows</code>.</li>
<li>Le <code>cubix</code>, un tableau de 4 <code>matrices</code>.</li>
</ul>
<p>La fonction va donc utiliser une matrice en 3 dimension dont chaque coefficient est un nonaire constitué de 9 bits appartenants à notre input.
Ce qui implique que dans un cubix il y&rsquo;a:<br>
4 * 4 * 4 * 9 bits = 576 bits, le nombre de bits de notre input,<br>
le compte est bon!</p>
<p>Et c&rsquo;est justement le rôle de la première fonction <code>slv2cubix</code> de ranger dans notre cubix chacun des bits du flag à chiffrer:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vhdl" data-lang="vhdl"><span class="line"><span class="cl">  <span class="k">function</span> <span class="n">slv2cubix</span><span class="p">(</span><span class="n">data</span> <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">data_width</span><span class="o">-</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">))</span> <span class="k">return</span> <span class="n">cubix</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl">    <span class="k">variable</span> <span class="n">tmp</span> <span class="o">:</span> <span class="n">cubix</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="n">cubix</span><span class="na">&#39;range</span> <span class="k">loop</span>
</span></span><span class="line"><span class="cl">      <span class="n">tmp</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">:=</span> <span class="n">slv2matrix</span><span class="p">(</span><span class="n">data</span><span class="p">(</span><span class="mi">144</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">144</span><span class="o">*</span><span class="n">k</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">end</span> <span class="nc">slv2cubix</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">function</span> <span class="n">slv2matrix</span><span class="p">(</span><span class="n">data</span> <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">matrix_width</span><span class="o">-</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">))</span> <span class="k">return</span> <span class="n">matrix</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl">    <span class="k">variable</span> <span class="n">tmp</span> <span class="o">:</span> <span class="n">matrix</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="k">in</span> <span class="n">matrix</span><span class="na">&#39;range</span> <span class="k">loop</span>
</span></span><span class="line"><span class="cl">      <span class="n">tmp</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">:=</span> <span class="n">slv2row</span><span class="p">(</span><span class="n">data</span><span class="p">(</span><span class="mi">36</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">36</span><span class="o">*</span><span class="n">j</span><span class="p">));</span> 
</span></span><span class="line"><span class="cl">    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">end</span> <span class="nc">slv2matrix</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">function</span> <span class="n">slv2row</span><span class="p">(</span><span class="n">data</span> <span class="o">:</span> <span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">row_width</span><span class="o">-</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">0</span><span class="p">))</span> <span class="k">return</span> <span class="n">row</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl">    <span class="k">variable</span> <span class="n">tmp</span> <span class="o">:</span> <span class="n">row</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">row</span><span class="na">&#39;range</span> <span class="k">loop</span>
</span></span><span class="line"><span class="cl">      <span class="n">tmp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">:=</span> <span class="n">data</span><span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">9</span><span class="o">*</span><span class="n">i</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">end</span> <span class="nc">slv2row</span><span class="p">;</span>
</span></span></code></pre></div><p>Lors d&rsquo;une seconde étape, La fonction shiftmt est appellée avec en agument une liste de matrices et dont la valeur de retour est passée dans la la fonction <code>mixcubix</code> avec notre cubix. Lorsque l&rsquo;on se penche sur cette dernière on remarque un enchainement peu commun d&rsquo;opérations XOR à différents niveaux sur notre cubix avec notamment l&rsquo;usage de deux fonctions mystérieuses : <code>times</code> et <code>times2</code> qui est d&rsquo;ailleurs commentée : <code>-- GF_mult2 : function qui multiplie par 2</code>.</p>
<h4 id="la-fonction-shiftmt">La fonction shiftmt:</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vhdl" data-lang="vhdl"><span class="line"><span class="cl">  <span class="k">function</span> <span class="n">shiftmt</span>     <span class="p">(</span><span class="n">mt</span> <span class="o">:</span> <span class="n">matrix_t</span><span class="p">;</span> <span class="n">p</span> <span class="o">:</span> <span class="kt">natural</span><span class="p">)</span> <span class="k">return</span> <span class="n">matrix_t</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl">    <span class="k">variable</span> <span class="n">tmp</span> <span class="o">:</span> <span class="n">matrix_t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">l</span> <span class="k">in</span> <span class="n">matrix_t</span><span class="na">&#39;range</span> <span class="k">loop</span>
</span></span><span class="line"><span class="cl">      <span class="n">tmp</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">:=</span> <span class="n">mt</span><span class="p">((</span><span class="n">l</span><span class="o">+</span><span class="n">p</span><span class="p">)</span> <span class="k">mod</span> <span class="n">square_size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">end</span> <span class="nc">shiftmt</span><span class="p">;</span> 
</span></span></code></pre></div><h4 id="les-matrices-utilisées">Les matrices utilisées:</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vhdl" data-lang="vhdl"><span class="line"><span class="cl"><span class="c1">--      m(x,y)            y     0            1         2          3          x</span>
</span></span><span class="line"><span class="cl"><span class="k">constant</span> <span class="n">m_0</span> <span class="o">:</span> <span class="n">matrix_c</span> <span class="o">:=</span><span class="p">((</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;03&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;02&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;06&#34;</span><span class="p">),</span>  <span class="c1">-- 0</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;06&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;03&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;02&#34;</span><span class="p">),</span>  <span class="c1">-- 1</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;02&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;06&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;03&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">),</span>  <span class="c1">-- 2</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;02&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;06&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;03&#34;</span><span class="p">));</span> <span class="c1">-- 3 </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">constant</span> <span class="n">m_1</span> <span class="o">:</span> <span class="n">matrix_c</span> <span class="o">:=</span><span class="p">((</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;06&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;04&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;03&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;06&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;04&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;03&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;03&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;06&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;04&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;04&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;03&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;06&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">constant</span> <span class="n">m_2</span> <span class="o">:</span> <span class="n">matrix_c</span> <span class="o">:=</span><span class="p">((</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;04&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;09&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;03&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;03&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;04&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;09&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;09&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;03&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;04&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;09&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;03&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;04&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">constant</span> <span class="n">m_3</span> <span class="o">:</span> <span class="n">matrix_c</span> <span class="o">:=</span><span class="p">((</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;02&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;04&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;09&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;09&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;02&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;04&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;09&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;02&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;04&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;04&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;00&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;09&#34;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="o">&amp;</span><span class="mh">x&#34;02&#34;</span><span class="p">));</span>
</span></span></code></pre></div><h4 id="la-fonction-mixrow-appellée-dans-la-fonction-mixmatrix">La fonction mixrow, appellée dans la fonction mixmatrix:</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vhdl" data-lang="vhdl"><span class="line"><span class="cl">  <span class="k">function</span> <span class="n">mixrow</span><span class="p">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">row</span><span class="p">;</span> <span class="n">m</span> <span class="o">:</span> <span class="n">matrix_c</span><span class="p">)</span> <span class="k">return</span> <span class="n">row</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl">    <span class="k">variable</span> <span class="n">tmp</span> <span class="o">:</span> <span class="n">row</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">row</span><span class="na">&#39;range</span> <span class="k">loop</span>
</span></span><span class="line"><span class="cl">        <span class="n">tmp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">:=</span> <span class="n">times</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">r</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="k">xor</span> <span class="n">times</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">r</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="k">xor</span> <span class="n">times</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">r</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="k">xor</span> <span class="n">times</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">r</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span> <span class="k">loop</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">end</span> <span class="nc">mixrow</span><span class="p">;</span>
</span></span></code></pre></div><p>On remarque alors une annotation en haut du fichier <code>cubix_pkg.vhd</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">-----------------------------------------------------------
</span></span><span class="line"><span class="cl">--                      FUNCTIONS
</span></span><span class="line"><span class="cl">-----------------------------------------------------------
</span></span><span class="line"><span class="cl">-- Primitive <span class="nv">polynomial</span> <span class="o">=</span> D^9+D^4+1  -- GF<span class="o">(</span>512<span class="o">)</span>
</span></span><span class="line"><span class="cl">-----------------------------------------------------------
</span></span></code></pre></div><p>Cette annotation nous signale que des opérations dans le groupe de Galois sont utilisées:<br>
Cela signifie que dans notre <code>cubix</code>, chaque nonaire est l&rsquo;équivalent d&rsquo;un polynome de degré 8 et dont chacun des coefficients sont contenus dans
l&rsquo;ensemble des classes d&rsquo;équivalence de la relation de congruence modulo 2, Z/2Z&hellip; Mais concrètement qu&rsquo;est ce que cela implique?</p>
<p>Cela implique que les opérations XOR qui sont utilisés dans les fonctions <code>mixcubix</code>,<code>mixmatrix</code> et <code>mixrow</code> sont en fait l&rsquo;équivalent d&rsquo;une simple application linéaire. Et ceci nous est confirmé par cette <a href="https://surf-vhdl.com/how-to-implement-galois-multiplier-in-vhdl/">page</a> sur laquelle on apprend que l&rsquo;addition entre 2 polynomes dans le champ de Galois GF(512) se fait par un XOR et que la mulitlication se fait par un enchainement de décalage de bits vers la gauche et de XOR.<br>
Ca ne vous rapelle rien?<br>
Et oui, la fonction <code>times2</code> servant à multiplier par 2 est en fait utilisée pour décaler les bits vers la gauche et implémente une multiplications entre les nonaires!</p>
<p>Une fois que l&rsquo;on sait cela, le fonctionnement de <code>mixcubix</code> devient plus clair:</p>
<ol>
<li>
<p>La fonction <code>shiftmt</code> est appellée pour pouvoir réaranger la liste de matrices dans un nouvel ordre.</p>
</li>
<li>
<p>Pour chaque matrice du <code>cubix</code>, La fonction <code>mixmatrix</code> est appelée avec en argument une des matrices du cubix ainsi que la nouvelle liste de matrices.</p>
</li>
<li>
<p>Chaque row de la matrice est multipliée par une des matrices de la liste.</p>
</li>
</ol>
<p>Pour inverser cet algorithme, il faudra donc inverser les matrices présentes dans la liste, ce qui est faisable avec la librairie <code>pyfinite</code> qui permet de créer des groupes finis comme celui dans lequelle on travaille:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyfinite</span> <span class="kn">import</span> <span class="n">ffield</span><span class="p">,</span> <span class="n">genericmatrix</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">GF_512</span> <span class="o">=</span> <span class="n">ffield</span><span class="o">.</span><span class="n">FField</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">XOR</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">GF_512</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">MUL</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">GF_512</span><span class="o">.</span><span class="n">Multiply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DIV</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">GF_512</span><span class="o">.</span><span class="n">Multiply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">GF_512</span><span class="o">.</span><span class="n">Inverse</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">mix_cubix</span><span class="p">(</span><span class="n">cubix</span><span class="p">,</span> <span class="n">matrix_list</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">matrix_list_i</span> <span class="o">=</span> <span class="n">shift_matrix</span><span class="p">(</span><span class="n">matrix_list</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">cubix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix_str_to_int</span><span class="p">(</span><span class="n">cubix</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">cubix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">matrix_list_i</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LeftMulColumnVec</span><span class="p">(</span><span class="n">cubix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cubix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix_int_to_str</span><span class="p">(</span><span class="n">cubix</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">cubix</span>
</span></span></code></pre></div><p>Puis la fonction <code>roundcubix</code> est appellée et qui va simplement faire un xor entre chaque nonaire de la clé de chiffrement et chaque nonaire de notre cubix actuel. Elle est donc modélisable dans <code>GF(512)</code> par une simple addition de matrice pour chaque matrice du cubix et du cubix de la clé:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">round_cubix</span><span class="p">(</span><span class="n">cubix</span><span class="p">,</span><span class="n">cubix_key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="n">matrix_int_to_str</span><span class="p">(</span><span class="n">matrix_str_to_int</span><span class="p">(</span><span class="n">cubix</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">matrix_str_to_int</span><span class="p">(</span><span class="n">cubix_key</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
</span></span></code></pre></div><p>La dernière transformation appliqué à notre input est une substitution des lignes de notre cubix:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vhdl" data-lang="vhdl"><span class="line"><span class="cl">  <span class="k">function</span> <span class="n">swap_rows</span> <span class="p">(</span><span class="n">c</span><span class="o">:</span> <span class="n">cubix</span><span class="p">)</span> <span class="k">return</span> <span class="n">cubix</span> <span class="k">is</span>
</span></span><span class="line"><span class="cl">  <span class="k">variable</span> <span class="n">tmp</span> <span class="o">:</span><span class="n">cubix</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">0</span><span class="p">)(</span><span class="mi">0</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">0</span><span class="p">)(</span><span class="mi">1</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">3</span><span class="p">)(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">0</span><span class="p">)(</span><span class="mi">2</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">2</span><span class="p">)(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">0</span><span class="p">)(</span><span class="mi">3</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">2</span><span class="p">)(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="mi">0</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">3</span><span class="p">)(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="mi">1</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">2</span><span class="p">)(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="mi">2</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">)(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="mi">3</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">2</span><span class="p">)(</span><span class="mi">0</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">2</span><span class="p">)(</span><span class="mi">1</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">)(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">2</span><span class="p">)(</span><span class="mi">2</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">2</span><span class="p">)(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">2</span><span class="p">)(</span><span class="mi">3</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">3</span><span class="p">)(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">3</span><span class="p">)(</span><span class="mi">0</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">3</span><span class="p">)(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">3</span><span class="p">)(</span><span class="mi">1</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">)(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">3</span><span class="p">)(</span><span class="mi">2</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="p">(</span><span class="mi">3</span><span class="p">)(</span><span class="mi">3</span><span class="p">)</span> <span class="o">:=</span> <span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">)(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">end</span> <span class="nc">swap_rows</span><span class="p">;</span> 
</span></span></code></pre></div><p>On la modélise donc simplement par:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">permutation</span><span class="p">(</span><span class="n">cubix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span> <span class="o">=</span> <span class="p">[</span><span class="n">genericmatrix</span><span class="o">.</span><span class="n">GenericMatrix</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">zeroElement</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">identityElement</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">add</span><span class="o">=</span><span class="n">XOR</span><span class="p">,</span><span class="n">mul</span><span class="o">=</span><span class="n">MUL</span><span class="p">,</span><span class="n">sub</span><span class="o">=</span><span class="n">XOR</span><span class="p">,</span><span class="n">div</span><span class="o">=</span><span class="n">DIV</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp_cubix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">cubix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">tmp_cubix</span>
</span></span></code></pre></div><p>Une fois les permutations effectuées, la fontion <code>round</code> extrait les données du cubix dans un bitvector et le retourne.<br>
Le code de chiffrement en Python pour le chiffrement ressemble donc à ceci:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">encryption</span><span class="p">(</span><span class="n">data_bitvector</span><span class="p">,</span> <span class="n">key_bitvector</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">key_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">key_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key_bitvector</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cubix_key</span> <span class="o">=</span> <span class="n">fill_cubix</span><span class="p">(</span><span class="n">key_bitvector</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">576</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cubix</span> <span class="o">=</span> <span class="n">fill_cubix</span><span class="p">(</span><span class="n">data_bitvector</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cubix</span> <span class="o">=</span> <span class="n">mix_cubix</span><span class="p">(</span><span class="n">cubix</span><span class="p">,[</span><span class="n">m_0</span><span class="p">,</span><span class="n">m_1</span><span class="p">,</span><span class="n">m_2</span><span class="p">,</span><span class="n">m_3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cubix</span> <span class="o">=</span> <span class="n">round_cubix</span><span class="p">(</span><span class="n">cubix</span><span class="p">,</span><span class="n">cubix_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cubix</span> <span class="o">=</span> <span class="n">permutation</span><span class="p">(</span><span class="n">cubix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">data_bitvector</span> <span class="o">=</span> <span class="n">extract_cubix</span><span class="p">(</span><span class="n">cubix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">key_bitvector</span> <span class="o">=</span> <span class="n">galois_lfsr</span><span class="p">(</span><span class="n">key_bitvector</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">data_bitvector</span><span class="p">,</span><span class="n">key_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="mh">0xf0ae2e1abee8afbe3ea424cc71f4ce17455a21d5df15cc4f6362e3af095cfb6da7188a9777c2c875ab39145a88a2142aea7b5411607110d70cd3d37c20f259b1920031990709d8e0e8d661b1a05fe8b5719aab6569835b3e52be738982608fda36549fd1e3398c725190356fbe97998b79f84f0ef23c4dea63898b52319a47a2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="mh">0x4841434B4441590000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">flag_encrypted</span> <span class="o">=</span> <span class="mh">0x79EEEF596B960C42262DFD1D0A2DB218FA3C71C681963F0CC389D3F0F5234C8023CA79D315186AF55621289F92AD6D9B657D999E074C84E13BFDAEDC94A3BA4FCB95B4013BFC40E5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">key_bitvector</span> <span class="o">=</span> <span class="n">int_to_bin</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="mi">1024</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_bitvector</span> <span class="o">=</span> <span class="n">int_to_bin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">576</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">flag_encrypted_bitvector</span> <span class="o">=</span> <span class="n">int_to_bin</span><span class="p">(</span><span class="n">flag_encrypted</span><span class="p">,</span><span class="mi">576</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">data_bitvector</span><span class="p">,</span><span class="n">key_list</span> <span class="o">=</span> <span class="n">encryption</span><span class="p">(</span><span class="n">data_bitvector</span><span class="p">,</span><span class="n">key_bitvector</span><span class="p">)</span>
</span></span></code></pre></div><p><ins>Remarque:</ins><br>
VHDL agence en temps normal ses tableaux en little endian, c&rsquo;est pourquoi il faut inverser le sens du bitvector <code>key</code> et <code>data</code> si on veut utiliser les tableaux dans le même sens que le code original.<br>
De plus la liste <code>key_list</code> enregistre la clé utilisée lors de chaque tour afin de la réutiliser dans la fonction de déchiffrement.</p>
<h2 id="inversion-de-lalgorithme">Inversion de l&rsquo;algorithme</h2>
<hr>
<p>Pour inverser l&rsquo;algorithme, on procède de cette manière:</p>
<ol>
<li>On effectue les permutations inverses que celles de la fonction <code>swap_rows</code>.</li>
<li>On réappelle la fonction <code>round_cubix</code> car dans le champ de Galois GF(512), l&rsquo;addition est équivalente à la soustraction et elle passe de la même manière par le XOR.</li>
<li>On inverse la liste de clés, logique on déchiffre en commencant par le dernier tour qui a été effectué.</li>
<li>On crée une fonction <code>reverse_mix_cubix</code> qui va se comporter de la même manière que la fonction <code>mix_cubix</code>, à un détail près:
au lieu de multiplier chaque <code>row</code> par une matrice, elle va la diviser (La librairie pyfinite s&rsquo;en chargera).</li>
<li>On extrait le bitvector du cubix et le tour est joué.</li>
</ol>
<p>La fonction <code>reverse_mix_cubix</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">reverse_mix_cubix</span><span class="p">(</span><span class="n">cubix</span><span class="p">,</span> <span class="n">matrix_list</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">matrix_list_i</span> <span class="o">=</span> <span class="n">shift_matrix</span><span class="p">(</span><span class="n">matrix_list</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">cubix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix_str_to_int</span><span class="p">(</span><span class="n">cubix</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">cubix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">SetRow</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">matrix_list_i</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">Solve</span><span class="p">(</span><span class="n">cubix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">cubix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix_int_to_str</span><span class="p">(</span><span class="n">cubix</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">cubix</span>
</span></span></code></pre></div><p>La fonction <code>decryption</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">decryption</span><span class="p">(</span><span class="n">data_bitvector</span><span class="p">,</span> <span class="n">key_list</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">cubix</span> <span class="o">=</span> <span class="n">fill_cubix</span><span class="p">(</span><span class="n">data_bitvector</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">key_bitvector</span> <span class="o">=</span> <span class="n">key_list</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">cubix_key</span> <span class="o">=</span> <span class="n">fill_cubix</span><span class="p">(</span><span class="n">key_bitvector</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">576</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cubix</span> <span class="o">=</span> <span class="n">reverse_permutation</span><span class="p">(</span><span class="n">cubix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cubix</span> <span class="o">=</span> <span class="n">round_cubix</span><span class="p">(</span><span class="n">cubix</span><span class="p">,</span><span class="n">cubix_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cubix</span> <span class="o">=</span> <span class="n">reverse_mix_cubix</span><span class="p">(</span><span class="n">cubix</span><span class="p">,[</span><span class="n">m_0</span><span class="p">,</span><span class="n">m_1</span><span class="p">,</span><span class="n">m_2</span><span class="p">,</span><span class="n">m_3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">extracted</span> <span class="o">=</span> <span class="n">extract_cubix</span><span class="p">(</span><span class="n">cubix</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">extracted</span>
</span></span></code></pre></div><p>Il ne nous reste plus qu&rsquo;à assembler chaque bit du bitvector retourné pour obtenir le flag:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="n">flag</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">576</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">byte</span> <span class="o">=</span> <span class="n">extracted</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">byte</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># HACKDAY{99b6b6d2c037a65d509c401c7d2f5052914e0a4e3420627d23d0b969daf1df3}</span>
</span></span></code></pre></div><p>Voici, le code VHDL du <a href="./assets/cubik_cipher-Copie.vhd">challenge</a> et le code Python du <a href="./assets/solve.py">solver</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<hr>
<p>Ce challenge mixant Crypto et Hardware a été très intéressant, il m&rsquo;a notamment permis d&rsquo;apréhender le domaine de l&rsquo;HDL et de mieux comprendre comment les groupes finis peuvent être utiles lorsque l&rsquo;on construit des systèmes électroniques.</p>
<!---
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠂⠀⢀⡠⠤⠒⠚⣉⣉⣩⢭⡉⠉⣉⣋⠁⠒⠤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡄⠀⠀⠀⠀⡀⢠⡤⢴⡶⠒⠋⣌⣉⣿⣿⣿⣿⣿⣿⣿⣿⣶⣮⣅⡅⡄⠀⢘⣿⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡠⢀⡅⠄⣀⣠⣶⢞⣹⡶⠚⢋⢈⡥⢵⣉⠟⣿⣿⣷⣿⣿⣿⣿⣿⣿⣿⣿⢿⣿⣿⣾⢭⡻⢆⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⢿⣧⣶⣿⣿⣿⣿⣿⣿⣿⢿⠿⣿⡿⠶⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣯⡛⣌⢺⡐⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡤⠲⢟⣿⣿⣿⣟⣿⣿⣿⣿⣽⢍⣸⣿⣿⣾⣶⣾⣿⣿⣿⣿⣿⡿⣿⣟⣿⣿⣿⣿⣿⣿⣻⣿⡿⣿⣾⣿⡁⠀⣀⣀⣀⡀⢀⣀⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠀⡀⢣⣾⣡⣾⣿⣿⣿⣷⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣟⣿⣿⣿⣷⣾⢷⣭⣉⣉⢡⣀⡉⠉⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣫⣿⣿⣿⣿⣿⣿⣟⡏⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⢿⣯⣿⣿⣿⣿⣿⣿⣿⣿⣿⣄⣀⢄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠋⡉⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣾⣿⣿⣿⣟⣿⣿⣿⣿⣿⡿⣿⣿⣿⣿⣴⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣟⡬⠀⢀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⣿⣿⣿⣶⣿⣿⣿⣿⣿⣻⢿⣿⣿⣿⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣟⣻⣉⣿⣷⣘⣿⣿⣿⣿⣿⣿⡿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣿⣿⡿⣟⣿⡿⢿⣿⢾⣽⣻⣶⡽⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢈⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⢿⣛⣻⣿⣽⣿⣻⣻⣿⣿⢏⣽⣿⣿⣿⡿⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣏⣿⣿⣿⣿⣽⣿⣻⣿⣾⣷⣽⣾⠻⣿⣿⣿⣹⣿⣿⣟⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣷⣶⡾⣿⡿⢿⣿⣿⣽⣿⣷⣬⣴⣿⣿⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣸⣟⢿⣿⣿⣟⣿⣿⣾⣿⣧⡬⢧⣽⢿⣟⣿⣿⣛⣿⣿⣿⣿⣿⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣤⣿⣿⣿⣿⣟⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣾⣾⣽⣿⣿⣿⣿⣟⣾⣻⣿⣿⣿⣿⡿⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⡿⣾⣿⣾⣿⣗⣿⣿⣿⣿⣿⣬⣿⣾⣙⣿⣿⣿⣿⣾⣟⣿⣯⠘⢤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣾⣿⣿⣿⣏⣙⣿⣿⣿⣿⣿⣽⣿⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⣿⣿⣿⣿⣾⣿⣿⣿⢿⣿⣿⣿⣿⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠈⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣾⣟⣛⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠨⠿⣿⣏⢿⣞⣧⣙⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠓⠺⢦⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⣟⣫⣯⣭⣯⣽⣿⣧⣿⣿⣿⣿⣷⢿⢿⣿⣿⢿⣿⣿⣛⣻⣿⣿⣿⣿⣿⣿⣿⣿⠟⠃⠀⠀⣜⢻⡞⢿⣿⣼⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣟⣋⣁⠴⣿⠿⠋⢱⡨⠊⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠙⠛⠻⠿⢿⣿⡿⡿⠿⠗⠛⠋⠁⠀⠀⠀⠀⠀⠉⠛⠻⢿⣆⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣹⢂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⣿⣿⣿⣿⣿⣿⠛⠻⠛⠇⣀⣠⣤⠶⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠂⠀⠀⢠⢹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣾⣿⣿⡗⠌⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢺⣿⣿⣿⣿⣿⣿⡿⠄⠒⠛⠛⠋⠉⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠂⠀⠀⠀⠠⣇⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⠀⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⣿⣿⣿⡏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠂⠀⠀⠀⠀⠀⢬⠄⢱⣻⣿⣿⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⢁⡈⡎⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⢿⣿⣿⡧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠄⣀⣀⠟⣿⣿⣿⣾⣿⣿⣿⣷⣿⣿⣿⣿⣿⣿⡏⡼⠔⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⡼⣿⣿⣿⣶⣦⣶⣶⣶⣶⣶⣶⣤⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⣀⣀⣤⣤⣤⣤⣦⣤⣤⣄⡀⠀⢀⣈⠀⠈⠇⣾⣿⣿⣿⣿⣿⣯⣿⣿⣿⣿⣿⣿⣿⣿⣵⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⣿⠅⠈⠉⠿⢿⣿⣿⣿⣿⣿⣿⣷⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣦⣼⣿⣿⣿⣿⣿⣿⣿⣿⢿⣿⣿⣿⠿⠿⢿⢿⣿⣧⣴⣴⣿⣿⣿⣿⣿⣿⣿⣻⣿⣿⣿⣿⣿⣿⣿⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⠀⠀⠀⣀⣬⣥⣬⡉⢛⡿⢿⣿⣿⣷⡁⢄⠀⠀⠀⢠⣴⣼⣛⣿⣿⣿⣿⣿⢛⣟⢏⡩⡁⣐⢒⣦⡤⣌⠨⢑⠢⠋⣿⣟⣿⣿⣿⢿⣿⣻⢷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢿⡧⢰⣿⢒⠙⢉⣁⣈⣁⣨⣿⢿⠿⣿⢻⣿⣄⠀⠀⠀⠀⠷⣟⣿⣿⣿⣍⣿⠲⣋⣙⣀⣀⣤⡝⢹⣿⣷⣾⢿⣸⣷⠝⠋⣭⡟⡿⣿⣜⣼⣿⡾⡯⣟⣻⣿⣿⣿⣿⣟⣿⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⡇⠠⠻⢶⡟⠋⠉⢹⣿⣿⣿⣿⣷⡝⠳⣽⡿⠃⠀⠀⠠⡰⢷⠓⠑⠛⣁⣔⠚⠉⢽⣿⣿⣿⣿⣻⣿⣿⡿⡻⠥⠇⠀⠀⣈⠼⢣⡹⣿⣿⣿⣿⣷⡻⣿⣿⣿⣿⣿⣿⣿⣿⣯⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠁⠀⠀⠀⠡⠠⣀⠀⠙⢿⡿⠟⠡⠝⠀⠡⠚⠀⠀⠀⠀⡔⠌⠐⠀⠈⠙⠂⠀⠀⠀⠙⠛⠟⢋⣡⣿⣾⠈⠁⠀⠀⠀⠐⠁⢽⡿⣟⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡄⠀⠀⠀⠀⠒⠉⠁⠹⠉⠀⠀⠁⠈⠀⠀⠀⠀⠀⠰⠉⡂⠀⠀⠀⠀⠀⠀⠈⠀⠓⠋⠈⠙⢛⠙⠀⠀⠀⠀⠀⠀⠈⠺⠻⣄⣻⣷⣿⣹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠀⠀⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⡲⠻⣳⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣽⢫⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠀⠀⠜⢡⡾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣿⡿⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⢶⠀⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠁⢰⡚⣿⣿⣿⣿⣿⣿⣿⣏⣽⣿⣿⡿⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⣡⠀⠀⠀⠀⢲⣎⡦⠈⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠂⠀⣤⣴⣿⣿⣷⣿⣿⣿⡟⣿⢿⣿⡿⡟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⢸⣋⠀⠀⠀⠀⠈⢣⣆⠁⣁⠛⣶⡐⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠀⡀⣠⡿⣫⣿⣿⢿⣿⣿⣿⣿⣿⡟⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡈⠻⣇⡿⣷⣶⣿⣿⣶⢷⣽⣿⠟⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠄⠀⡶⣨⣷⡶⠋⢩⣷⣾⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⠀⠀⠀⠐⠀⠀⠈⣿⢷⣿⡿⠿⡯⢙⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⠀⠀⡀⡠⠼⣟⣋⠍⣴⣿⡿⣿⣿⣯⣟⣿⣿⣿⣿⣿⣷⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⠀⠀⠀⠁⡉⠋⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣡⣦⢴⣟⣽⣯⣿⣿⣿⡿⠯⢟⣿⣿⣿⣿⣿⣿⣿⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣦⠌⠁⠀⠀⣂⣠⠈⣀⣀⠀⠀⠀⠀⠀⠀⢀⠀⡀⢀⠀⠀⠀⠀⠀⠀⠀⡀⠈⠿⠃⣄⢚⣛⣽⣿⣿⣿⣿⣵⣫⣿⣿⣿⣿⣿⣿⣿⣮⣻⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣷⡄⠀⢀⠈⠙⣿⡿⢾⣿⣠⣶⣶⣾⣿⣷⣿⣿⡟⠂⠀⠀⠀⠀⠁⠈⢀⣰⣿⣼⡶⣻⡿⣽⣞⣿⣿⣴⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⣿⣯⣑⡀⠀⠀⠀⠘⠒⣦⣼⣯⣍⣥⣽⡿⣛⡻⠣⠁⠀⠀⠀⠀⠀⠀⠘⣸⣿⣿⡿⢿⢶⣿⣩⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⠇⣷⢿⣿⣿⣿⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣿⣿⡿⣿⣿⣿⣆⠄⠀⠀⠀⠀⠻⠿⣿⣿⡿⠿⢁⡓⠐⠀⠀⠀⠀⠀⣠⣞⣭⣿⣿⣽⣿⣿⣿⣕⣈⣵⣿⣿⣿⣿⣿⣿⡿⣿⠏⠺⠁⢸⠯⣿⣿⣿⣷⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡼⢿⠋⡇⠹⣿⣿⣿⣜⠢⠈⠀⠀⠀⠁⠀⠀⠂⠀⠀⠀⠀⠄⠀⠀⣄⣫⣥⡟⢽⣿⢿⣿⣿⣷⣷⣿⣿⣿⣿⣿⣿⣿⣿⣟⣿⡟⠀⠀⠀⠏⢠⢿⣿⣯⣿⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⡿⠻⠞⢡⠃⠸⢻⣿⣿⣷⣆⠂⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣚⣿⣿⣿⣿⣭⣼⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠁⠀⠀⠀⠀⠆⠘⣿⣿⣿⣿⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⠀⠀⠀⠀⠀⠀⠀⢰⡿⠋⣐⡔⢆⠀⠈⡾⣽⣿⣿⣷⡜⣆⣀⡀⠀⢀⡀⠀⢀⡀⣰⣼⣽⣾⣿⣿⣿⣯⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣯⣿⡿⠀⠀⠀⠀⠀⠀⠀⢀⢺⢛⣿⣿⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⠀⠈⠉⣌⠼⠿⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣾⣿⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠃⠀⠀⠀⠀⠀⠠⠉⠀⠌⠘⠀⢛⣿⢻⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡏⠀⠀⠈⠁⠀⠀⠀⠀⢸⣻⣿⣿⣿⣿⣿⣿⢿⣿⣿⣿⣿⣿⣿⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠁⠀⠀⠀⠀⠀⠰⠀⠀⠀⢀⡄⠀⢸⣿⣼⣷⡂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣏⣿⣿⣝⢷⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠀⠀⠀⠀⠀⡐⠀⠀⠀⣰⠁⠀⠀⢖⡶⢹⢿⣿⠂⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠄⠀⠀⠀⠀⠀⠀⠀⠀⣟⡀⠀⠀⠀⠐⠀⠀⠀⠀⠀⠸⢾⣿⣿⣿⣿⣷⡿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠏⠀⠠⠀⠀⢀⠀⠐⠀⢀⠐⠀⠀⠀⠀⠚⡄⣿⢩⣿⡄⢂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣿⠁⠀⠀⠀⢸⠀⠀⡄⠀⠀⠀⠿⢿⣿⣿⡿⠾⢟⣻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠁⠀⠀⢺⡃⡀⠉⠒⣠⡜⠉⠀⠀⠀⡘⠀⠸⢅⣿⢈⣿⢣⠈⠀⠀⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⡿⠀⠀⠀⠀⠸⠀⠀⢠⠀⠀⠄⠀⡘⣿⣿⣿⣿⣿⡿⠿⢟⣻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣿⣿⡟⠁⡀⠀⠀⠀⡾⢔⢃⡀⠀⠉⠀⠀⠀⠀⠠⠷⠆⠀⣸⢿⢿⣿⢸⠒⢦⣍⡉⠁⢄⠤⢄⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡌⠓⠀⠀⠀⠀⠀⠀⠀⠘⡀⠀⠐⠀⠡⠹⣿⣿⣿⣯⡶⢞⢛⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢟⣻⣿⣿⣟⡿⡋⠀⠀⠀⣴⣧⣟⢼⡀⠀⢀⣦⠄⠘⠀⠀⢈⠀⢀⠇⠠⣼⡟⢸⠀⠀⢍⠿⠶⣧⢄⣈⡀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠄⠇⠈⠀⠀⢸⠀⠀⠀⠀⠀⠃⠀⠀⠁⠀⠀⢻⣿⡿⣞⡻⣏⣽⡿⢶⣿⡿⠿⣿⡿⢛⣩⣝⣑⣽⣿⣿⣿⡿⠕⠀⠀⠀⡼⣿⡿⢓⢠⢫⠞⠏⣠⠂⡀⠀⠀⠇⠀⠎⠀⢠⠿⡇⠈⠀⠀⠀⠀⢠⣀⡙⠦⡉⠓⢦⣄⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡃⠆⠀⠀⠀⠄⠀⠀⠀⠀⠀⠀⠀⠀⠄⢀⠀⢻⣿⣿⣷⣺⣿⠿⣿⢗⣿⣿⣶⠿⣋⣩⣿⣿⣿⣿⣿⡟⠀⠀⠄⢀⠞⣽⠛⢁⣟⡬⠈⣠⡿⢿⡧⢀⢤⢰⠏⠀⠀⠀⣿⠻⠁⢠⠀⠀⠀⠀⢹⡴⣄⠀⠤⣒⢄⡘⠷
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣸⠀⡇⠀⠠⠀⠁⠀⠀⠁⠀⠀⢀⠀⠀⠰⡖⠀⠈⡿⣿⣿⣿⣿⣪⣶⠿⢿⣟⠉⢉⣭⣽⣿⣿⣿⡿⠋⠀⠀⠀⣰⠏⢴⣧⣦⡾⢈⡇⢽⣿⣖⢫⠰⣦⡰⡫⠒⠀⢠⣤⡏⡀⠀⡟⠀⠀⠀⠀⢃⠁⠈⢎⡐⠤⢁⡍⠲
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠄⣪⠞⣻⠀⣀⠄⠀⠁⠀⠁⠀⠀⠀⠀⠀⠀⠀⠀⠑⠀⠀⢱⢻⣿⣿⣿⣿⣛⣓⡊⡀⣥⣾⣾⣿⣿⣿⡿⠁⠀⠀⢠⢴⠗⠀⣿⡿⠙⠙⠙⡍⢠⣿⣿⠿⠀⢹⢷⠀⢰⡀⢻⡟⠴⡁⠊⠀⠀⠀⠀⠀⠈⠂⠀⠀⠈⠀⠀⠈⠓
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⢤⠎⠀⠀⢹⠀⣼⠀⠀⠀⠀⢃⠀⠀⠀⡀⠀⠀⡄⠀⠀⠰⠀⠘⡏⢻⣿⡯⠿⣟⣿⣇⣉⣿⣿⣿⡟⡹⠋⠀⠀⠀⠀⠸⠃⢀⣴⡋⠀⠀⡀⠀⠀⣸⣻⣯⠆⠁⣨⠂⢠⣿⣥⡟⠁⠙⠁⠀⠄⠀⠀⠀⠀⠀⠀⠆⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⡠⢚⠔⠁⠀⠀⠀⠈⠀⢿⠀⠀⠀⡀⠐⠀⠀⠀⡇⠀⠀⢸⠀⠀⠀⢠⠀⠈⢄⣻⣯⡄⢃⡀⢀⣿⣿⣿⢋⠎⠀⠀⠀⠀⠀⠀⠀⡴⠻⠉⠁⢀⠖⠀⠀⣾⣿⡏⠈⢠⣿⢁⢠⣿⣫⡟⠁⠀⣀⠃⠀⠀⢀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢀⠤⠀⠀⠂⠠⠔⢈⠖⢊⠐⠁⠀⠀⠀⠀⠀⠀⠀⠸⡆⠀⠀⠀⠀⠀⠀⠀⠠⡀⠀⠀⠀⠀⠀⠀⠀⠂⠀⢳⣻⡀⢀⡴⠾⠋⠘⠴⠁⠀⠀⠀⠀⠀⠄⠀⠈⠐⠀⢀⠀⠀⠀⠀⣴⠛⢀⠐⣴⣷⣱⣧⡸⣴⣿⡷⠀⠀⡉⠀⠀⢀⠀⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⡀⢀⠀⠀⠲⠊⡡⠂⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⡀⠀⠀⠀⠀⠀⠀⠈⠡⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⠻⣷⠉⠀⣤⠀⠀⠀⠐⠁⠀⡀⠀⠀⠀⠔⠀⣀⠄⠀⠀⢀⠀⠡⠅⢀⡤⣠⣿⣿⡿⢁⣴⠃⡿⠀⠃⢠⡇⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠁⠀⢤⣴⣾⣶⣻⣟⡷⢊⡠⠊⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⠀⣼⠃⠀⣈⡆⠀⡇⠀⠀⠀⠀⡠⠂⠁⠀⠀⠁⠀⠚⡁⠂⢀⡰⠋⠀⠐⡰⠚⣱⣷⢟⣽⡵⠾⠏⠀⠁⠀⠀⢠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠉⠘⢮⠨⢿⠠⠊⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⢀⠀⠀⠀⠀⠀⠄⠀⠀⢀⠂⡼⠁⠀⠀⠉⠃⠈⢳⠀⠀⠀⠈⠀⣀⡊⠀⠆⠀⣀⡆⠀⡴⠋⠀⠀⣠⠏⢁⣾⠟⢡⢞⡆⠃⠀⠀⠀⠀⠀⠀⢸⠀⠘⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢈⡗⠙⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⡇⠐⠱⠀⠀⠀⠀⠀⠀⠀⠈⠄⠀⣢⣿⠗⠀⠀⠀⠀⠀⠀⠘⡇⠀⠱⠀⠀⠉⠀⠀⢀⠾⠀⠁⠀⠀⠀⣠⣾⠟⣴⠟⠃⢠⠯⠟⠁⠀⠀⠀⠀⠀⠀⠀⢸⠀⠠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠈⣰⡰⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢻⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣦⣿⡿⠀⠀⠀⠀⠀⠀⠀⠀⠙⡔⠂⠀⡀⠀⠀⡴⠋⠀⡀⠀⠀⠐⠊⠀⣠⡾⠋⠀⢰⡿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⡦⠼⠉⠐⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢣⠀⠀⠁⠀⠃⠀⠀⠀⠀⣿⣿⣿⠇⠀⠀⠐⠐⠒⠀⠀⠀⠀⠘⣄⠀⠐⡀⠀⠀⠀⠀⠀⠀⢀⢄⣴⠞⠉⠀⠀⣰⠿⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢐⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⡄⠀⠀⠀⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢆⠀⠀⢣⠀⠀⠀⣰⣰⣿⡿⡽⠀⠀⠀⠀⠀⠀⠀⠀⡀⠀⠀⠘⣆⠀⠱⡀⠀⠁⠀⢀⣤⣾⠟⣉⢀⡠⠄⡾⠋⠀⠀⠀⢀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠀⡀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
-->
</div>
  
    <div class="mt-16">

</div>
  
</article>
      </div>
    </main><footer class="fixed left-0 bottom-0 w-full bg-base px-page-gutter">
  <div class="flex justify-center items-center h-footer-height">
    <div
      class="flex flex-row w-full max-w-content justify-between lowercase italic gap-3"
    >
      <nav>
        <ul class="flex text-md space-x-3 sm:space-x-6">
          
        </ul>
      </nav>
      <span class="text-muted hidden md:block">
        &copy;
        2023
        <a
          href="https://github.com/ntk148v/hugo-toigian"
          class="font-bold hover:underline"
          >hugo-toigian</a
        >
      </span>
      <div id="header-theme-button">
        <svg
          id="dark_mode_btn"
          class="hidden toolbox-btn"
          width="18px"
          height="18px"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"
          />
        </svg>
        <svg
          id="light_mode_btn"
          class="hidden toolbox-btn"
          width="18px"
          height="18px"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"
          />
        </svg>
      </div>
    </div>
  </div>
</footer>
</body>
</html>
